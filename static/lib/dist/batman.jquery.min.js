(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=Array.prototype.slice,Y=Object.prototype.hasOwnProperty,Z=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},_=function(a,b){function d(){this.constructor=a}for(var c in b)Y.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},ba=function(a,b){return function(){return a.apply(b,arguments)}};A=function(){var a;return a=1>arguments.length?[]:X.call(arguments,0),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(A.Object,a,function(){})},A.config={pathPrefix:"/",usePushState:!1},A.typeOf=w=function(a){return typeof a=="undefined"?"Undefined":U.call(a).slice(8,-1)},U=Object.prototype.toString,A.mixin=m=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=2>arguments.length?[]:X.call(arguments,1),a=typeof e.set=="function";for(g=0,h=d.length;g<h;g++){c=d[g];if(w(c)!=="Object")continue;for(b in c){if(!Y.call(c,b))continue;f=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.set(b,f):e.nodeName!=null?A.data(e,b,f):e[b]=f}typeof c.initialize=="function"&&c.initialize.call(e)}return e},A.unmixin=z=function(){var a,b,c,d,e,f;a=arguments[0],d=2>arguments.length?[]:X.call(arguments,1);for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;delete a[b]}typeof c.uninitialize=="function"&&c.uninitialize.call(a)}return a},A._block=c=function(a,b){var c,d;return b!=null?c=a:b=a,d=function(){var a,d,e;return a=1>arguments.length?[]:X.call(arguments,0),d=this,e=function(c){return a.push(c),b.apply(d,a)},typeof a[a.length-1]=="function"||c&&a.length>=c?e(a.pop()):e}},A._findName=f=function(a,b){var c,d;if(!a.displayName)for(c in b){d=b[c];if(d===a){a.displayName=c;break}}return a.displayName},A._functionName=h=function(a){var b;return a.__name__?a.__name__:a.name?a.name:(b=a.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?b[1]:void 0},A._preventDefault=p=function(a){return typeof a.preventDefault=="function"?a.preventDefault():a.returnValue=!1},A._isChildOf=l=function(a,b){var c;c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1},t=d=null,S=function(){var a,b,c,e,f,g,h;return a=function(){var a,b;return G.postMessage?(a=!0,b=G.onmessage,G.onmessage=function(){return a=!1},G.postMessage("","*"),G.onmessage=b,a):!1},h=new A.SimpleHash,b=0,e=function(){return"go"+ ++b},G.setImmediate?(t=G.setImmediate,d=G.clearImmediate):G.msSetImmediate?(t=msSetImmediate,d=msClearImmediate):a()?(g="com.batman.",c=new A.SimpleHash,f=function(a){var b,c;if(!~a.data.search(g))return;return b=a.data.substring(g.length),typeof (c=h.unset(b))=="function"?c():void 0},G.addEventListener?G.addEventListener("message",f,!1):G.attachEvent("onmessage",f),t=function(a){var b;return h.set(b=e(),a),G.postMessage(g+b,"*"),b},d=function(a){return h.unset(a)}):typeof document=="undefined"||Z.call(document.createElement("script"),"onreadystatechange")<0?(t=function(a){return setTimeout(a,0)},d=function(a){return clearTimeout(a)}):(t=function(a){var b,c;return b=e(),c=document.createElement("script"),c.onreadystatechange=function(){var a;return typeof (a=h.get(b))=="function"&&a(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},document.documentElement.appendChild(c),b},d=function(a){return h.unset(a)}),A.setImmediate=t,A.clearImmediate=d},A.setImmediate=t=function(){return S(),A.setImmediate.apply(this,arguments)},A.clearImmediate=d=function(){return S(),A.clearImmediate.apply(this,arguments)},A.translate=function(a,b){return b==null&&(b={}),J.interpolate(i(A.translate.messages,a),b)},A.translate.messages={},N=function(){return A.translate.apply(A,arguments)},E=/(?:^|_|\-)(.)/g,F=/(^|\s)([a-z])/g,O=/([A-Z]+)([A-Z][a-z])/g,P=/([a-z\d])([A-Z])/g,J=A.helpers={camelize:function(a,b){return a=a.replace(E,function(a,b){return b.toUpperCase()}),b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(O,"$1_$2").replace(P,"$1_$2").replace("-","_").toLowerCase()},singularize:function(a){var b;return b=a.length,a.substr(b-3)==="ies"?a.substr(0,b-3)+"y":a.substr(b-1)==="s"?a.substr(0,b-1):a},pluralize:function(a,b){var c,d;if(b){if(a===1)return b}else b=a;return d=b.length,c=b.substr(d-1),c==="y"?""+b.substr(0,d-1)+"ies":c==="s"?b:""+b+"s"},capitalize:function(a){return a.replace(F,function(a,b,c){return b+c.toUpperCase()})},trim:function(a){return a?a.trim():""},interpolate:function(a,b){var c,d,e;typeof a=="object"?(d=a[b.count],d||(d=a.other)):d=a;for(c in b)e=b[c],d=d.replace(new RegExp("%\\{"+c+"\\}","g"),e);return d}},A.Event=function(){function a(a,b){this.base=a,this.key=b,this.handlers=new A.SimpleSet,this._preventCount=0}return a.forBaseAndKey=function(a,b){return a.isEventEmitter?a.event(b):new A.Event(a,b)},a.prototype.isEvent=!0,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;return this.hashKey=function(){return a},a="<Batman.Event base: "+A.Hash.prototype.hashKeyFor(this.base)+', key: "'+A.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.addHandler=function(a){return this.handlers.add(a),this.oneShot&&this.autofireHandler(a),this},a.prototype.removeHandler=function(a){return this.handlers.remove(a),this},a.prototype.eachHandler=function(a){var b,c;this.handlers.forEach(a);if((c=this.base)!=null?c.isEventEmitter:void 0)return b=this.key,this.base._batman.ancestors(function(c){var d;if(c.isEventEmitter&&c.hasEvent(b))return d=c.event(b).handlers,d.forEach(a)})},a.prototype.handlerContext=function(){return this.base},a.prototype.prevent=function(){return++this._preventCount},a.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},a.prototype.isPrevented=function(){return this._preventCount>0},a.prototype.autofireHandler=function(a){if(this._oneShotFired&&this._oneShotArgs!=null)return a.apply(this.handlerContext(),this._oneShotArgs)},a.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},a.prototype.fire=function(){var a,b;return this.isPrevented()||this._oneShotFired?!1:(b=this.handlerContext(),a=arguments,this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=arguments),this.eachHandler(function(c){return c.apply(b,a)}))},a.prototype.allowAndFire=function(){return this.allow(),this.fire.apply(this,arguments)},a}(),A.EventEmitter={isEventEmitter:!0,hasEvent:function(a){var b,c;return(b=this._batman)!=null?typeof b.get=="function"?(c=b.get("events"))!=null?c.hasKey(a):void 0:void 0:void 0},event:function(a){var b,c,d,e,f,g,h;return A.initializeObject(this),b=this.eventClass||A.Event,c=(g=this._batman).events||(g.events=new A.SimpleHash),c.hasKey(a)?d=c.get(a):(e=this._batman.get("events"),f=c.set(a,new b(this,a)),f.oneShot=e!=null?(h=e.get(a))!=null?h.oneShot:void 0:void 0,f)},on:function(a,b){return this.event(a).addHandler(b)},registerAsMutableSource:function(){return A.Property.registerSource(this)},mutation:function(a){return function(){var b;return b=a.apply(this,arguments),this.event("change").fire(this,this),b}},prevent:function(a){return this.event(a).prevent(),this},allow:function(a){return this.event(a).allow(),this},isPrevented:function(a){return this.event(a).isPrevented()},fire:function(){var a,b,c;return b=arguments[0],a=2>arguments.length?[]:X.call(arguments,1),(c=this.event(b)).fire.apply(c,a)},allowAndFire:function(){var a,b,c;return b=arguments[0],a=2>arguments.length?[]:X.call(arguments,1),(c=this.event(b)).allowAndFire.apply(c,a)}},A.PropertyEvent=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Event),a.prototype.eachHandler=function(a){return this.base.eachObserver(a)},a.prototype.handlerContext=function(){return this.base.base},a}(),A.Property=function(){function a(a,b){this.base=a,this.key=b}return m(a.prototype,A.EventEmitter),a._sourceTrackerStack=[],a.sourceTracker=function(){var a;return(a=this._sourceTrackerStack)[a.length-1]},a.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){var b;return b=this[a],delete this[a],b}},a.forBaseAndKey=function(a,b){return a.isObservable?a.property(b):new A.Keypath(a,b)},a.registerSource=function(a){var b;if(!a.isEventEmitter)return;return(b=this.sourceTracker())!=null?b.add(a):void 0},a.prototype._isolationCount=0,a.prototype.cached=!1,a.prototype.value=null,a.prototype.sources=null,a.prototype.isProperty=!0,a.prototype.eventClass=A.PropertyEvent,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;return this.hashKey=function(){return a},a="<Batman.Property base: "+A.Hash.prototype.hashKeyFor(this.base)+', key: "'+A.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.changeEvent=function(){var a;return a=this.event("change"),this.changeEvent=function(){return a},a},a.prototype.accessor=function(){var a,b,c,d,e;return b=(d=this.base._batman)!=null?d.get("keyAccessors"):void 0,a=b&&(c=b.get(this.key))?c:((e=this.base._batman)!=null?e.getFirst("defaultAccessor"):void 0)||A.Property.defaultAccessor,this.accessor=function(){return a},a},a.prototype.eachObserver=function(a){var b;b=this.key,this.changeEvent().handlers.forEach(a);if(this.base.isObservable)return this.base._batman.ancestors(function(c){var d,e;if(c.isObservable&&c.hasProperty(b))return e=c.property(b),d=e.event("change").handlers,d.forEach(a)})},a.prototype.pushSourceTracker=function(){return A.Property._sourceTrackerStack.push(new A.SimpleSet)},a.prototype.pushDummySourceTracker=function(){return A.Property._sourceTrackerStack.push(null)},a.prototype.popSourceTracker=function(){return A.Property._sourceTrackerStack.pop()},a.prototype.updateSourcesFromTracker=function(){var a,b;return b=this.popSourceTracker(),a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),this.sources=b,this._eachSourceChangeEvent(function(b){return b.addHandler(a)})},a.prototype._eachSourceChangeEvent=function(a){if(this.sources==null)return;return this.sources.forEach(function(b){return a(b.event("change"))})},a.prototype.getValue=function(){return this.registerAsMutableSource(),this.cached||(this.pushSourceTracker(),this.value=this.valueFromAccessor(),this.cached=!0,this.updateSourcesFromTracker()),this.value},a.prototype.refresh=function(){var a,b;this.cached=!1,a=this.value,b=this.getValue();if(b!==a&&!this.isIsolated())return this.fire(b,a)},a.prototype.sourceChangeHandler=function(){var a;return a=ba(function(){return this._handleSourceChange()},this),this.sourceChangeHandler=function(){return a},a},a.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.changeEvent().handlers.isEmpty()?this.cached=!1:this.refresh()},a.prototype.valueFromAccessor=function(){var a;return(a=this.accessor().get)!=null?a.call(this.base,this.key):void 0},a.prototype.setValue=function(a){var b,c;return this.pushDummySourceTracker(),this.cached=!1,b=(c=this.accessor().set)!=null?c.call(this.base,this.key,a):void 0,this.refresh(),this.popSourceTracker(),b},a.prototype.unsetValue=function(){var a,b,c,d,e;return this.pushDummySourceTracker(),a=(b=this.accessor().unset)!=null?b.call(this.base,this.key):void 0,this.refresh(),this.popSourceTracker(),(this.sources==null||this.sources.length===0)&&((c=this.changeEvent().handlers)!=null?c.length:void 0)===0&&(d=this.base._batman)!=null&&(e=d.properties)!=null&&e.unset(this.key),a},a.prototype.forget=function(a){return a!=null?this.changeEvent().removeHandler(a):this.changeEvent().handlers.clear()},a.prototype.observeAndFire=function(a){return this.observe(a),a.call(this.base,this.value,this.value)},a.prototype.observe=function(a){return this.changeEvent().addHandler(a),this.getValue(),this},a.prototype.removeSourceHandlers=function(){var a;return a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),this.forget()},a.prototype.fire=function(){var a;return(a=this.changeEvent()).fire.apply(a,arguments)},a.prototype.isolate=function(){return this._isolationCount===0&&(this._preIsolationValue=this.getValue()),this._isolationCount++},a.prototype.expose=function(){if(this._isolationCount===1)return this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue),this._preIsolationValue=null;if(this._isolationCount>0)return this._isolationCount--},a.prototype.isIsolated=function(){return this._isolationCount>0},a}(),A.Keypath=function(){function a(b,c){w(c)==="String"?(this.segments=c.split("."),this.depth=this.segments.length):(this.segments=[c],this.depth=1),a.__super__.constructor.apply(this,arguments)}return _(a,A.Property),a.prototype.slice=function(a,b){var c,d,e,f,g;b==null&&(b=this.depth),c=this.base,g=this.segments.slice(0,a);for(e=0,f=g.length;e<f;e++){d=g[e];if(c==null||!(c=A.Property.forBaseAndKey(c,d).getValue()))return}return A.Property.forBaseAndKey(c,this.segments.slice(a,b).join("."))},a.prototype.terminalProperty=function(){return this.slice(-1)},a.prototype.valueFromAccessor=function(){var b;return this.depth===1?a.__super__.valueFromAccessor.apply(this,arguments):(b=this.terminalProperty())!=null?b.getValue():void 0},a.prototype.setValue=function(b){var c;return this.depth===1?a.__super__.setValue.apply(this,arguments):(c=this.terminalProperty())!=null?c.setValue(b):void 0},a.prototype.unsetValue=function(){var b;return this.depth===1?a.__super__.unsetValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.unsetValue():void 0},a}(),A.Observable={isObservable:!0,hasProperty:function(a){var b,c;return(b=this._batman)!=null?(c=b.properties)!=null?typeof c.hasKey=="function"?c.hasKey(a):void 0:void 0:void 0},property:function(a){var b,c,d;return A.initializeObject(this),c=this.propertyClass||A.Keypath,b=(d=this._batman).properties||(d.properties=new A.SimpleHash),b.get(a)||b.set(a,new c(this,a))},get:function(a){return this.property(a).getValue()},set:function(a,b){return this.property(a).setValue(b)},unset:function(a){return this.property(a).unsetValue()},getOrSet:function(a,b){var c;return c=this.get(a),c||(c=b(),this.set(a,c)),c},forget:function(a,b){var c;return a?this.property(a).forget(b):(c=this._batman.properties)!=null&&c.forEach(function(a,b){return b.forget()}),this},observe:function(){var a,b,c;return b=arguments[0],a=2>arguments.length?[]:X.call(arguments,1),(c=this.property(b)).observe.apply(c,a),this},observeAndFire:function(){var a,b,c;return b=arguments[0],a=2>arguments.length?[]:X.call(arguments,1),(c=this.property(b)).observeAndFire.apply(c,a),this}},i=A.get=function(a,b){return a.get!=null&&typeof a.get=="function"?a.get(b):A.Property.forBaseAndKey(a,b).getValue()},A.initializeObject=function(a){return a._batman!=null?a._batman.check(a):a._batman=new Q(a)},A._Batman=Q=function(){function a(){var a,b;b=arguments[0],a=2>arguments.length?[]:X.call(arguments,1),this.object=b,a.length>0&&m.apply(null,[this].concat(X.call(a)))}return a.prototype.check=function(b){return b!==this.object?(b._batman=new a(b),!1):!0},a.prototype.get=function(a){var b;b=this.getAll(a);switch(b.length){case 0:return;case 1:return b[0];default:return b[0].concat!=null?b=b.reduceRight(function(a,b){return a.concat(b)}):b[0].merge!=null&&(b=b.reduceRight(function(a,b){return a.merge(b)})),b}},a.prototype.getFirst=function(a){var b;return b=this.getAll(a),b[0]},a.prototype.getAll=function(a){var b,c,d;return typeof a=="function"?b=a:b=function(b){var c;return(c=b._batman)!=null?c[a]:void 0},c=this.ancestors(b),(d=b(this.object))&&c.unshift(d),c},a.prototype.ancestors=function(a){var b,c,d,e,f,g,h;return a==null&&(a=function(a){return a}),e=[],b=!!this.object.prototype,c=b?(g=this.object.__super__)!=null?g.constructor:void 0:(d=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:d,c!=null&&((h=c._batman)!=null&&h.check(c),f=a(c),f!=null&&e.push(f),c._batman!=null&&(e=e.concat(c._batman.ancestors(a)))),e},a.prototype.set=function(a,b){return this[a]=b},a}(),B=function(){function c(){var a;a=1>arguments.length?[]:X.call(arguments,0),this._batman=new Q(this),this.mixin.apply(this,a)}var a,b;return A.initializeObject(c),A.initializeObject(c.prototype),c.global=function(a){if(a===!1)return;return G[h(this)]=this},c.classMixin=function(){return m.apply(null,[this].concat(X.call(arguments)))},c.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},c.prototype.mixin=c.classMixin,a=0,c.prototype._objectID=function(){var b;return this._objectID=function(){return b},b=a++},c.prototype.hashKey=function(){var a;if(typeof this.isEqual=="function")return;return this.hashKey=function(){return a},a="<Batman.Object "+this._objectID()+">"},c.prototype.toJSON=function(){var a,b,c;b={};for(a in this){if(!Y.call(this,a))continue;c=this[a],a!=="_batman"&&a!=="hashKey"&&a!=="_objectID"&&(b[a]=c.toJSON?c.toJSON():c)}return b},b=function(a){return!a.get&&!a.set&&!a.unset&&(a={get:a}),a},c.classAccessor=function(){var a,c,d,e,f,g,h,i;d=2>arguments.length?(f=0,[]):X.call(arguments,0,f=arguments.length-1),a=arguments[f++],A.initializeObject(this);if(d.length===0)return this._batman.defaultAccessor=b(a);(e=this._batman).keyAccessors||(e.keyAccessors=new A.SimpleHash),i=[];for(g=0,h=d.length;g<h;g++)c=d[g],i.push(this._batman.keyAccessors.set(c,b(a)));return i},c.accessor=function(){return this.classAccessor.apply(this.prototype,arguments)},c.prototype.accessor=c.classAccessor,c.classMixin(A.EventEmitter,A.Observable),c.mixin(A.EventEmitter,A.Observable),c.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},c.singleton=function(a){return a==null&&(a="sharedInstance"),this.classAccessor(a,{get:function(){var b;return this[b="_"+a]||(this[b]=new this)}})},c}(),A.Object=B,A.Accessible=function(){function a(){this.accessor.apply(this,arguments)}return _(a,A.Object),a}(),A.TerminalAccessible=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Accessible),a.prototype.propertyClass=A.Property,a}(),A.Enumerable={isEnumerable:!0,map:function(a,b){var c;return b==null&&(b=G),c=[],this.forEach(function(){return c.push(a.apply(b,arguments))}),c},every:function(a,b){var c;return b==null&&(b=G),c=!0,this.forEach(function(){return c=c&&a.apply(b,arguments)}),c},some:function(a,b){var c;return b==null&&(b=G),c=!1,this.forEach(function(){return c=c||a.apply(b,arguments)}),c},reduce:function(a,b){var c,d;return c=0,d=this,this.forEach(function(){return b!=null?b=a.apply(null,[b].concat(X.call(arguments),[c],[d])):b=arguments[0]}),b},filter:function(a){var b,c;return b=new this.constructor,b.add?c=function(b,c){return a(c)&&b.add(c),b}:b.set?c=function(b,c,d){return a(c,d)&&b.set(c,d),b}:(b.push||(b=[]),c=function(b,c){return a(c)&&b.push(c),b}),this.reduce(c,b)}},e=function(a){var b,c,d,e;d=A.Enumerable,e=[];for(b in d)c=d[b],e.push(a[b]=c);return e},A.SimpleHash=function(){function a(){this._storage={},this.length=0}return e(a.prototype),a.prototype.propertyClass=A.Property,a.prototype.hasKey=function(a){var b,c,d,e;if(c=this._storage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return!0}return!1},a.prototype.get=function(a){var b,c,d,e;if(c=this._storage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return b[1]}},a.prototype.set=function(a,b){var c,d,e,f,g,h;d=(e=this._storage)[h=this.hashKeyFor(a)]||(e[h]=[]);for(f=0,g=d.length;f<g;f++){c=d[f];if(this.equality(c[0],a))return c[1]=b}return this.length++,d.push([a,b]),b},a.prototype.unset=function(a){var b,c,d,e,f,g,h,i;b=this.hashKeyFor(a);if(f=this._storage[b])for(c=0,h=f.length;c<h;c++){i=f[c],d=i[0],g=i[1];if(this.equality(d,a))return e=f.splice(c,1),f.length||delete this._storage[b],this.length--,e[0][1]}},a.prototype.getOrSet=A.Observable.getOrSet,a.prototype.hashKeyFor=function(a){return(a!=null?typeof a.hashKey=="function"?a.hashKey():void 0:void 0)||a},a.prototype.equality=function(a,b){return a===b?!0:a!==a&&b!==b?!0:(a!=null?typeof a.isEqual=="function"?a.isEqual(b):void 0:void 0)&&(b!=null?typeof b.isEqual=="function"?b.isEqual(a):void 0:void 0)?!0:!1},a.prototype.forEach=function(a){var b,c,d,e,f,g;f=this._storage,g=[];for(b in f)e=f[b],g.push(function(){var b,f,g,h,i;g=e.slice(),i=[];for(b=0,f=g.length;b<f;b++)h=g[b],c=h[0],d=h[1],i.push(a(c,d));return i}());return g},a.prototype.keys=function(){var a;return a=[],A.SimpleHash.prototype.forEach.call(this,function(b){return a.push(b)}),a},a.prototype.clear=function(){return this._storage={},this.length=0},a.prototype.isEmpty=function(){return this.length===0},a.prototype.merge=function(){var a,b,c,d,e;c=1>arguments.length?[]:X.call(arguments,0),b=new this.constructor,c.unshift(this);for(d=0,e=c.length;d<e;d++)a=c[d],a.forEach(function(a,c){return b.set(a,c)});return b},a.prototype.toJSON=function(){return this.reduce(function(a,b,c){return a[b]=c.toJSON?c.toJSON():c,a},{})},a}(),A.Hash=function(){function h(){var a;A.SimpleHash.apply(this,arguments),this.meta=new A.Object,a=this,this.meta.accessor("length",function(){return a.registerAsMutableSource(),a.length}),this.meta.accessor("isEmpty",function(){return a.isEmpty()}),this.meta.accessor("keys",function(){return a.keys()}),h.__super__.constructor.apply(this,arguments)}var a,b,c,d,f,g;_(h,A.Object),e(h.prototype),h.prototype.propertyClass=A.Property,h.accessor({get:A.SimpleHash.prototype.get,set:h.mutation(function(a,b){var c;return c=A.SimpleHash.prototype.set.call(this,a,b),this.fire("itemsWereAdded",a),c}),unset:h.mutation(function(a){var b;return b=A.SimpleHash.prototype.unset.call(this,a),b!=null&&this.fire("itemsWereRemoved",a),b})}),h.prototype.clear=h.mutation(function(){var a,b;return a=this.meta.get("keys"),this.forEach(ba(function(a){return this.unset(a)},this)),b=A.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(X.call(a))),b}),h.prototype.equality=A.SimpleHash.prototype.equality,h.prototype.hashKeyFor=A.SimpleHash.prototype.hashKeyFor,g=["hasKey","forEach","isEmpty","keys","merge","toJSON"],c=function(a){return b[a]=function(){return this.registerAsMutableSource(),A.SimpleHash.prototype[a].apply(this,arguments)}};for(d=0,f=g.length;d<f;d++)a=g[d],b=h.prototype,c(a);return h}(),A.SimpleSet=function(){function a(){this._storage=new A.SimpleHash,this._indexes=new A.SimpleHash,this._sorts=new A.SimpleHash,this.length=0,arguments.length>0&&this.add.apply(this,arguments)}return e(a.prototype),a.prototype.has=function(a){return this._storage.hasKey(a)},a.prototype.add=function(){var a,b,c,d,e;c=1>arguments.length?[]:X.call(arguments,0),a=[];for(d=0,e=c.length;d<e;d++)b=c[d],this._storage.hasKey(b)||(this._storage.set(b,!0),a.push(b),this.length++);return this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(X.call(a)))),a},a.prototype.remove=function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),c=[];for(d=0,e=b.length;d<e;d++)a=b[d],this._storage.hasKey(a)&&(this._storage.unset(a),c.push(a),this.length--);return this.fire&&c.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(X.call(c)))),c},a.prototype.forEach=function(a){return this._storage.forEach(function(b,c){return a(b)})},a.prototype.isEmpty=function(){return this.length===0},a.prototype.clear=function(){var a;return a=this.toArray(),this._storage=new A.SimpleHash,this.length=0,this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(X.call(a)))),a},a.prototype.toArray=function(){return this._storage.keys()},a.prototype.merge=function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),a=new this.constructor,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.forEach(function(b){return a.add(b)});return a},a.prototype.indexedBy=function(a){return this._indexes.get(a)||this._indexes.set(a,new A.SetIndex(this,a))},a.prototype.sortedBy=function(a,b){var c;return b==null&&(b="asc"),b=b.toLowerCase()==="desc"?"desc":"asc",c=this._sorts.get(a)||this._sorts.set(a,new A.Object),c.get(b)||c.set(b,new A.SetSort(this,a,b))},a}(),A.Set=function(){function k(){A.SimpleSet.apply(this,arguments)}var a,b,c,d,f,g,h,i,j;_(k,A.Object),e(k.prototype),i=["add","remove","clear","indexedBy","sortedBy"];for(d=0,g=i.length;d<g;d++)a=i[d],k.prototype[a]=A.SimpleSet.prototype[a];j=["merge","forEach","toArray","isEmpty","has"],c=function(a){return b[a]=function(){return this.registerAsMutableSource(),A.SimpleSet.prototype[a].apply(this,arguments)}};for(f=0,h=j.length;f<h;f++)a=j[f],b=k.prototype,c(a);return k.prototype.toJSON=k.prototype.toArray,k.accessor("indexedBy",function(){return new A.TerminalAccessible(ba(function(a){return this.indexedBy(a)},this))}),k.accessor("sortedBy",function(){return new A.TerminalAccessible(ba(function(a){return this.sortedBy(a)},this))}),k.accessor("sortedByDescending",function(){return new A.TerminalAccessible(ba(function(a){return this.sortedBy(a,"desc")},this))}),k.accessor("isEmpty",function(){return this.isEmpty()}),k.accessor("toArray",function(){return this.toArray()}),k.accessor("length",function(){return this.registerAsMutableSource(),this.length}),k}(),A.SetObserver=function(){function a(a){this.base=a,this._itemObservers=new A.SimpleHash,this._setObservers=new A.SimpleHash,this._setObservers.set("itemsWereAdded",ba(function(){return this.fire.apply(this,["itemsWereAdded"].concat(X.call(arguments)))},this)),this._setObservers.set("itemsWereRemoved",ba(function(){return this.fire.apply(this,["itemsWereRemoved"].concat(X.call(arguments)))},this)),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return _(a,A.Object),a.prototype.observedItemKeys=[],a.prototype.observerForItemAndKey=function(a,b){},a.prototype._getOrSetObserverForItemAndKey=function(a,b){return this._itemObservers.getOrSet(a,ba(function(){var c;return c=new A.SimpleHash,c.getOrSet(b,ba(function(){return this.observerForItemAndKey(a,b)},this))},this))},a.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},a.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},a.prototype.startObservingItems=function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"observe"));return e},a.prototype.stopObservingItems=function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"forget"));return e},a.prototype._manageObserversForItem=function(a,b){var c,d,e,f;if(!a.isObservable)return;f=this.observedItemKeys;for(d=0,e=f.length;d<e;d++)c=f[d],a[b](c,this._getOrSetObserverForItemAndKey(a,c));if(b==="forget")return this._itemObservers.unset(a)},a.prototype._manageItemObservers=function(a){return this.base.forEach(ba(function(b){return this._manageObserversForItem(b,a)},this))},a.prototype._manageSetObservers=function(a){if(!this.base.isObservable)return;return this._setObservers.forEach(ba(function(b,c){return this.base.event(b)[a](c)},this))},a}(),A.SetProxy=function(){function o(){o.__super__.constructor.call(this),this.length=0}var a,b,c,d,f,g,h,i,j,k,l,m,n;_(o,A.Object),e(o.prototype),o.prototype.filter=function(a){var b;return b=new A.Set,this.reduce(function(b,c){return a(c)&&b.add(c),b},b)},l=["add","remove","clear"],b=ba(function(a){return this.prototype[a]=function(){var b,c;return b=(c=this.base)[a].apply(c,arguments),this.length=this.set("length",this.base.get("length")),b}},o);for(f=0,i=l.length;f<i;f++)a=l[f],b(a);m=["has","merge","toArray","isEmpty"],c=ba(function(a){return this.prototype[a]=function(){var b;return(b=this.base)[a].apply(b,arguments)}},o);for(g=0,j=m.length;g<j;g++)a=m[g],c(a);n=["isEmpty","toArray"],d=ba(function(a){return this.accessor(a,function(){return this.base.get(a)})},o);for(h=0,k=n.length;h<k;h++)a=n[h],d(a);return o.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(a,b){return this.length=b}}),o}.call(this),A.SetSort=function(){function a(b,c,d){var e;this.base=b,this.key=c,d==null&&(d="asc"),a.__super__.constructor.call(this),this.descending=d.toLowerCase()==="desc",this.base.isObservable&&(this._setObserver=new A.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],e=this._reIndex.bind(this),this._setObserver.observerForItemAndKey=function(){return e},this._setObserver.on("itemsWereAdded",e),this._setObserver.on("itemsWereRemoved",e),this.startObserving()),this._reIndex()}return _(a,A.SetProxy),a.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},a.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},a.prototype.toArray=function(){return this.get("_storage")},a.accessor("toArray",a.prototype.toArray),a.prototype.forEach=function(a){var b,c,d,e,f;e=this.get("_storage"),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(a(b,c));return f},a.prototype.compare=function(a,b){var c;return a===b?0:a===void 0?1:b===void 0?-1:a===null?1:b===null?-1:(typeof a.isEqual=="function"?a.isEqual(b):void 0)&&(typeof b.isEqual=="function"?b.isEqual(a):void 0)?0:(c=A.SetSort.prototype.compare(w(a),w(b)),c!==0?c:a!==a?1:b!==b?-1:a>b?1:a<b?-1:0)},a.prototype._reIndex=function(){var a,b;return a=this.base.toArray().sort(ba(function(a,b){var c,d,e;return d=i(a,this.key),d!=null&&(d=d.valueOf()),e=i(b,this.key),e!=null&&(e=e.valueOf()),c=this.descending?-1:1,this.compare.call(this,d,e)*c},this)),(b=this._setObserver)!=null&&b.startObservingItems.apply(b,a),this.set("_storage",a)},a}(),A.SetIndex=function(){function a(b,c){this.base=b,this.key=c,a.__super__.constructor.call(this),this._storage=new A.SimpleHash,this.base.isEventEmitter&&(this._setObserver=new A.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",ba(function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._addItem(a));return e},this)),this._setObserver.on("itemsWereRemoved",ba(function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._removeItem(a));return e},this))),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return _(a,A.Object),a.accessor(function(a){return this._resultSetForKey(a)}),a.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},a.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},a.prototype.observerForItemAndKey=function(a,b){return ba(function(b,c){return this._removeItemFromKey(a,c),this._addItemToKey(a,b)},this)},a.prototype._addItem=function(a){return this._addItemToKey(a,this._keyForItem(a))},a.prototype._addItemToKey=function(a,b){return this._resultSetForKey(b).add(a)},a.prototype._removeItem=function(a){return this._removeItemFromKey(a,this._keyForItem(a))},a.prototype._removeItemFromKey=function(a,b){var c;c=this._resultSetForKey(b),c.remove(a);if(c.isEmpty())return this._storage.unset(b)},a.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,function(){return new A.Set})},a.prototype._keyForItem=function(a){return A.Keypath.forBaseAndKey(a,this.key).getValue()},a}(),A.UniqueSetIndex=function(){function a(){this._uniqueIndex=new A.Hash,a.__super__.constructor.apply(this,arguments)}return _(a,A.SetIndex),a.accessor(function(a){return this._uniqueIndex.get(a)}),a.prototype._addItemToKey=function(a,b){this._resultSetForKey(b).add(a);if(!this._uniqueIndex.hasKey(b))return this._uniqueIndex.set(b,a)},a.prototype._removeItemFromKey=function(b,c){var d;return d=this._resultSetForKey(c),a.__super__._removeItemFromKey.apply(this,arguments),d.isEmpty()?this._uniqueIndex.unset(c):this._uniqueIndex.set(c,d.toArray()[0])},a}(),A.StateMachine={initialize:function(){A.initializeObject(this);if(!this._batman.states)return this._batman.states=new A.SimpleHash},state:function(a,b){A.StateMachine.initialize.call(this);if(!a)return this._batman.getFirst("state");this[a]||(this[a]=function(b){return W.call(this,a)});if(typeof b=="function")return this.on(a,b)},transition:function(a,b,c){A.StateMachine.initialize.call(this),this.state(a),this.state(b);if(c)return this.on(""+a+"->"+b,c)}},A.Object.actsAsStateMachine=function(a){a==null&&(a=!0),A.StateMachine.initialize.call(this),A.StateMachine.initialize.call(this.prototype),this.classState=function(){return A.StateMachine.state.apply(this,arguments)},this.state=function(){return this.classState.apply(this.prototype,arguments)},a&&(this.prototype.state=this.classState),this.classTransition=function(){return A.StateMachine.transition.apply(this,arguments)},this.transition=function(){return this.classTransition.apply(this.prototype,arguments)};if(a)return this.prototype.transition=this.classTransition},W=function(a){var b,c,d;return A.StateMachine.initialize.call(this),this._batman.isTransitioning?(((c=this._batman).nextState||(c.nextState=[])).push(a),!1):(this._batman.isTransitioning=!0,b=this.state(),this._batman.state=a,a&&b&&this.fire(""+b+"->"+a,a,b),a&&this.fire(a,a,b),this._batman.isTransitioning=!1,((d=this._batman.nextState)!=null?d.length:void 0)&&this[this._batman.nextState.shift()](),a)},A.Request=function(){function a(b){var c,d,e;d={};for(e in b){c=b[e];if(e==="success"||e==="error"||e==="loading"||e==="loaded")d[e]=c,delete b[e]}a.__super__.constructor.call(this,b);for(e in d)c=d[e],this.on(e,c)}return _(a,A.Object),a.objectToFormData=function(a){var b,c,d,e,f,g,h,i;d=function(a,b,c){var e,f,g;return c==null&&(c=!1),f=function(){switch(A.typeOf(b)){case"Object":return f=function(){var f;f=[];for(e in b)g=b[e],f.push(d(c?e:""+a+"["+e+"]",g));return f}(),f.reduce(function(a,b){return a.concat(b)},[]);case"Array":return b.reduce(function(b,c){return b.concat(d(""+a+"[]",c))},[]);default:return[[a,b]]}}()},b=new FormData,h=d("",a,!0);for(f=0,g=h.length;f<g;f++)i=h[f],c=i[0],e=i[1],b.append(c,e);return b},a.prototype.url="",a.prototype.data="",a.prototype.method="get",a.prototype.formData=!1,a.prototype.response=null,a.prototype.status=null,a.prototype.contentType="application/x-www-form-urlencoded",a.observeAll("url",function(){return this._autosendTimeout=t(ba(function(){return this.send()},this))}),a.prototype.send=function(){},a.prototype.cancel=function(){if(this._autosendTimeout)return clearTimeout(this._autosendTimeout)},a}(),A.App=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Object),a.requirePath="",a.layout=void 0,a.event("ready").oneShot=!0,a.event("run").oneShot=!0,a.run=function(){if(A.currentApp){if(A.currentApp===this)return;A.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,A.currentApp=this,typeof this.dispatcher=="undefined"&&(this.dispatcher||(this.dispatcher=new A.Dispatcher(this))),this.observe("layout",ba(function(a){return a!=null?a.on("ready",ba(function(){return this.fire("ready")},this)):void 0},this)),typeof this.layout=="undefined"?this.set("layout",new A.View({contexts:[this],node:document})):typeof this.layout=="string"&&this.set("layout",new(this[J.camelize(this.layout)+"View"])),typeof this.navigator=="undefined"&&this.dispatcher.routeMap&&this.on("run",ba(function(){return this.navigator=A.navigator=A.Navigator.forApp(this),this.navigator.start()},this)),this.hasRun=!0,this.fire("run"),this)},a.event("ready").oneShot=!0,a.event("stop").oneShot=!0,a.stop=function(){var a;return(a=this.navigator)!=null&&a.stop(),A.navigator=null,this.hasRun=!1,this.fire("stop"),this},a}.call(this),A.Route=function(){function f(){var g;f.__super__.constructor.apply(this,arguments),this.pattern=this.url.replace(a,"\\$&"),this.regexp=new RegExp("^"+this.pattern.replace(c,"([^/]*)").replace(e,"(.*?)")+d+"$"),this.namedArguments=[];while((g=b.exec(this.pattern))!=null)g[1]&&this.namedArguments.push(g[1])}var a,b,c,d,e;return _(f,A.Object),c=/:([\w\d]+)/g,e=/\*([\w\d]+)/g,d="(?:\\?.+)?",b=/[:|\*]([\w\d]+)/g,a=/[-[\]{}()+?.,\\^$|#\s]/g,f.accessor("action",{get:function(){var a,b,c;if(this.action)return this.action;if(this.options){b=m({},this.options);if(c=b.signature)a=c.split("#"),b.controller=a[0],b.action=a[1]||"index";return b.target=this.dispatcher.get(b.controller),this.set("action",b)}},set:function(a,b){return this.action=b}}),f.prototype.parameterize=function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r;o=a.split("?"),a=o[0],h=o[1],c=(p=this.regexp.exec(a))!=null?p.slice(1):void 0,g={url:a},b=this.get("action"),typeof b=="function"?g.action=b:m(g,b);if(c)for(d=0,l=c.length;d<l;d++)f=c[d],g[this.namedArguments[d]]=f;if(h){q=h.split("&");for(k=0,n=q.length;k<n;k++)i=q[k],r=i.split("="),e=r[0],j=r[1],g[e]=j}return g},f.prototype.dispatch=function(a){var b,c,d,e;return w(a)==="String"&&(c=this.parameterize(a)),!(b=c.action)&&a!=="/404"&&q("/404"),typeof b=="function"?b(c):((d=c.target)!=null?d.dispatch:void 0)?c.target.dispatch(b,c):(e=c.target)!=null?e[b](c):void 0},f}(),A.Dispatcher=function(){function a(a){var b,c,d;this.app=a,this.app.route(this),this.app.controllers=new A.Object,d=this.app;for(c in d){b=d[c];if((b!=null?b.prototype:void 0)instanceof A.Controller)this.prepareController(b);else continue}}return _(a,A.Object),a.prototype.prepareController=function(a){var b,c;c=J.underscore(h(a).replace("Controller",""));if(!c)return;return b=function(){return this[c]=a.get("sharedController")},this.accessor(c,b),this.app.controllers.accessor(c,b)},a.prototype.register=function(a,b){var c;return a.indexOf("/")!==0&&(a="/"+a),c=w(b)==="Function"?new A.Route({url:a,action:b,dispatcher:this}):new A.Route({url:a,options:b,dispatcher:this}),this.routeMap||(this.routeMap={}),this.routeMap[a]=c},a.prototype.findRoute=function(a){var b,c,d;a.indexOf("/")!==0&&(a="/"+a);if(b=this.routeMap[a])return b;d=this.routeMap;for(c in d){b=d[c];if(b.regexp.test(a))return b}},a.prototype.findUrl=function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o;n=this.routeMap;for(k in n){j=n[k],e=!1,f=j.options,a.resource?e=f.resource===a.resource&&f.action===a.action:(b=j.get("action"),typeof b=="function"?e=!0:(o=b,c=o.controller,b=o.action,c===a.controller&&b===(a.action||"index")&&(e=!0)));if(!e)continue;m(g={},a),z(g,{controller:null,action:null,resource:null,url:null,signature:null,target:null});for(d in a){l=a[d],i=new RegExp("[:|*]"+d);if(!i.test(k))continue;k=k.replace(i,l),g[d]=null,delete g[d]}h="";for(d in g)l=g[d],h+=h?"&":"?",h+=d+"="+l;return k+h}},a.prototype.pathFromParams=function(a){return w(a)==="String"?A.Navigator.normalizePath(a):this.findUrl(a)},a.prototype.dispatch=function(a){var b,c;return c=this.pathFromParams(a),b=this.findRoute(c),b?b.dispatch(c):c!=="/404"&&q("/404"),this.app.set("currentURL",c),this.app.set("currentRoute",b),this.app.set("currentParams",a),c},a}(),A.Navigator=function(){function a(a){this.app=a,this.handleCurrentLocation=ba(this.handleCurrentLocation,this)}return a.defaultClass=function(){return A.config.usePushState&&A.PushStateNavigator.isSupported()?A.PushStateNavigator:A.HashbangNavigator},a.forApp=function(a){return new(this.defaultClass())(a)},a.prototype.start=function(){if(typeof window=="undefined")return;if(this.started)return;return this.started=!0,this.startWatching(),A.currentApp.prevent("ready"),t(ba(function(){return this.handleCurrentLocation(),A.currentApp.allowAndFire("ready")},this))},a.prototype.stop=function(){return this.stopWatching(),this.started=!1},a.prototype.handleLocation=function(a){var b;b=this.pathFromLocation(a);if(b===this.cachedPath)return;return this.dispatch(b)},a.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},a.prototype.dispatch=function(a){return this.cachedPath=this.app.dispatcher.dispatch(a)},a.prototype.push=function(a){var b;return b=this.dispatch(a),this.pushState(null,"",b),b},a.prototype.replace=function(a){var b;return b=this.dispatch(a),this.replaceState(null,"",b),b},a.prototype.redirect=a.prototype.push,a.prototype.normalizePath=function(){var a,b,c;return c=1>arguments.length?[]:X.call(arguments,0),c=function(){var d,e;e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push((""+b).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return e}(),c.join("")||"/"},a.normalizePath=a.prototype.normalizePath,a}(),A.PushStateNavigator=function(){function b(){b.__super__.constructor.apply(this,arguments)}return _(b,A.Navigator),b.isSupported=function(){var a;return(typeof window!=="undefined"&&window!==null?(a=window.history)!=null?a.pushState:void 0:void 0)!=null},b.prototype.startWatching=function(){return a(window,"popstate",this.handleCurrentLocation)},b.prototype.stopWatching=function(){return r(window,"popstate",this.handleCurrentLocation)},b.prototype.pushState=function(a,b,c){return window.history.pushState(a,b,this.linkTo(c))},b.prototype.replaceState=function(a,b,c){return window.history.replaceState(a,b,this.linkTo(c))},b.prototype.linkTo=function(a){return this.normalizePath(A.config.pathPrefix,a)},b.prototype.pathFromLocation=function(a){var b,c;return b=""+(a.pathname||"")+(a.search||""),c=new RegExp("^"+this.normalizePath(A.config.pathPrefix)),this.normalizePath(b.replace(c,""))},b.prototype.handleLocation=function(a){var c,d;return d=this.pathFromLocation(a),d==="/"&&(c=A.HashbangNavigator.prototype.pathFromLocation(a))!=="/"?this.replace(c):b.__super__.handleLocation.apply(this,arguments)},b}(),A.HashbangNavigator=function(){function b(){b.__super__.constructor.apply(this,arguments)}return _(b,A.Navigator),b.prototype.HASH_PREFIX="#!",typeof window!="undefined"&&window!==null&&"onhashchange"in window?(b.prototype.startWatching=function(){return a(window,"hashchange",this.handleCurrentLocation)},b.prototype.stopWatching=function(){return r(window,"hashchange",this.handleCurrentLocation)}):(b.prototype.startWatching=function(){return this.interval=setInterval(this.handleCurrentLocation,100)},b.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),b.prototype.pushState=function(a,b,c){return window.location.hash=this.linkTo(c)},b.prototype.replaceState=function(a,b,c){var d;return d=window.location,d.replace(""+d.pathname+d.search+this.linkTo(c))},b.prototype.linkTo=function(a){return this.HASH_PREFIX+a},b.prototype.pathFromLocation=function(a){var b;return b=a.hash,(b!=null?b.substr(0,2):void 0)===this.HASH_PREFIX?this.normalizePath(b.substr(2)):"/"},b.prototype.handleLocation=function(a){var c;return A.config.usePushState?(c=A.PushStateNavigator.prototype.pathFromLocation(a),c==="/"?b.__super__.handleLocation.apply(this,arguments):a.replace(this.normalizePath(""+A.config.pathPrefix+this.linkTo(c)))):b.__super__.handleLocation.apply(this,arguments)},b}(),A.redirect=q=function(a){var b;return(b=A.navigator)!=null?b.redirect(a):void 0},A.App.classMixin({route:function(a,b,c){var d,e,f,g;c==null&&(c={});if(!a)return;if(a instanceof A.Dispatcher){d=a,g=this._dispatcherCache;for(e in g)f=g[e],d.register(e,f);return this._dispatcherCache=null,d}return w(b)==="String"?c.signature=b:w(b)==="Function"?c=b:b&&m(c,b),this._dispatcherCache||(this._dispatcherCache={}),this._dispatcherCache[a]=c},root:function(a,b){return this.route("/",a,b)},resources:function(a,b,c){var d,e,f;b==null&&(b={}),typeof b=="function"&&(c=b,b={}),a=J.pluralize(a),e=b.controller||a,b.parentResource&&(a=""+b.parentResource+"/:"+J.singularize(b.parentResource)+"Id/"+a),b.index!==!1&&this.route(a,""+e+"#index",{resource:e,action:"index"}),b["new"]!==!1&&this.route(""+a+"/new",""+e+"#new",{resource:e,action:"new"}),b.show!==!1&&this.route(""+a+"/:id",""+e+"#show",{resource:e,action:"show"}),b.edit!==!1&&this.route(""+a+"/:id/edit",""+e+"#edit",{resource:e,action:"edit"});if(c)return d=this,f={collection:function(b){return b!=null?b.call({route:function(b,c){return d.route(""+a+"/"+b,""+e+"#"+(c||b))}}):void 0},member:function(b){return b!=null?b.call({route:function(b,c){return d.route(""+a+"/:id/"+b,""+e+"#"+(c||b))}}):void 0},resources:ba(function(b,c,d){return c==null&&(c={}),typeof c=="function"&&(d=c,c={}),c.parentResource=a,this.resources(b,c,d)},this)},c.call(f)},redirect:q}),A.Controller=function(){function a(){this.redirect=ba(this.redirect,this),a.__super__.constructor.apply(this,arguments)}return _(a,A.Object),a.singleton("sharedController"),a.beforeFilter=function(a){var b,c;A.initializeObject(this),b=(c=this._batman).beforeFilters||(c.beforeFilters=[]);if(b.indexOf(a)===-1)return b.push(a)},a.accessor("controllerName",{get:function(){return this._controllerName||(this._controllerName=J.underscore(h(this.constructor).replace("Controller","")))}}),a.afterFilter=function(a){var b,c;A.initializeObject(this),b=(c=this._batman).afterFilters||(c.afterFilters=[]);if(b.indexOf(a)===-1)return b.push(a)},a.accessor("action",{get:function(){return this._currentAction},set:function(a,b){return this._currentAction=b}}),a.prototype.dispatch=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;b==null&&(b={}),b.controller||(b.controller=this.get("controllerName")),b.action||(b.action=a),b.target||(b.target=this),e=(k=A.navigator)!=null?k.redirect:void 0,(l=A.navigator)!=null&&(l.redirect=this.redirect),this._actedDuringAction=!1,this.set("action",a),this.set("params",b);if(d=(m=this.constructor._batman)!=null?m.get("beforeFilters"):void 0)for(g=0,i=d.length;g<i;g++)c=d[g],typeof c=="function"?c.call(this,b):this[c](b);this[a](b),this._actedDuringAction||this.render();if(d=(n=this.constructor._batman)!=null?n.get("afterFilters"):void 0)for(h=0,j=d.length;h<j;h++)c=d[h],typeof c=="function"?c.call(this,b):this[c](b);delete this._actedDuringAction,(o=A.navigator)!=null&&(o.redirect=e),f=this._afterFilterRedirect,delete this._afterFilterRedirect;if(f)return q(f)},a.prototype.redirect=function(a){if(this._actedDuringAction)throw"DoubleRedirectError";return this.get("action")?(this._actedDuringAction=!0,this._afterFilterRedirect=a):(w(a)==="Object"&&(a.controller||(a.controller=this)),q(a))},a.prototype.render=function(a){var b,c,d,e;a==null&&(a={});if(this._actedDuringAction)throw"DoubleRenderError";this._actedDuringAction=!0;if(a===!1)return;a.view||(b=h(this.constructor).replace("Controller",""),a.contexts||(a.contexts=[]),a.contexts.push(this),a.source||(a.source=J.underscore(b)+"/"+this._currentAction),a.view=new(((d=A.currentApp)!=null?d[J.camelize(""+b+"_"+this._currentAction+"_view")]:void 0)||A.View)(a));if(c=a.view)(e=A.currentApp)!=null&&e.prevent("ready"),c.on("ready",ba(function(){var b;return A.DOM.replace(a.into||"main",c.get("node")),(b=A.currentApp)!=null&&b.allowAndFire("ready"),typeof c.ready=="function"?c.ready(this.params):void 0},this));return c},a}(),A.Model=function(){function m(a){a==null&&(a={}),this.destroy=ba(this.destroy,this),this.save=ba(this.save,this),this.load=ba(this.load,this),this.dirtyKeys=new A.Hash,this.errors=new A.ErrorsSet,w(a)==="Object"?m.__super__.constructor.call(this,a):(m.__super__.constructor.call(this),this.set("id",a)),this.state()||this.empty()}var a,b,c,d,e,f,g,i,j,k,l;_(m,A.Object),m.primaryKey="id",m.storageKey=null,m.persist=function(){var a,b,c,d,e;return b=1>arguments.length?[]:X.call(arguments,0),A.initializeObject(this.prototype),d=(e=this.prototype._batman).storage||(e.storage=[]),c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],a=a.isStorageAdapter?a:new a(this),d.push(a),f.push(a);return f}.call(this),c.length>1?c:c[0]},m.encode=function(){var a,b,c,d,e,f,g,h,i,j,k;e=2>arguments.length?(h=0,[]):X.call(arguments,0,h=arguments.length-1),c=arguments[h++],A.initializeObject(this.prototype),(f=this.prototype._batman).encoders||(f.encoders=new A.SimpleHash),(g=this.prototype._batman).decoders||(g.decoders=new A.SimpleHash);switch(w(c)){case"String":e.push(c);break;case"Function":b=c;break;default:b=c.encode,a=c.decode}typeof b=="undefined"&&(b=this.defaultEncoder.encode),typeof a=="undefined"&&(a=this.defaultEncoder.decode),k=[];for(i=0,j=e.length;i<j;i++)d=e[i],b&&this.prototype._batman.encoders.set(d,b),k.push(a?this.prototype._batman.decoders.set(d,a):void 0);return k},m.defaultEncoder={encode:function(a){return a},decode:function(a){return a}},m.observeAndFire("primaryKey",function(a){return this.encode(a,{encode:!1,decode:this.defaultEncoder.decode})}),m.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l;a=2>arguments.length?(i=0,[]):X.call(arguments,0,i=arguments.length-1),e=arguments[i++],A.initializeObject(this.prototype),g=(h=this.prototype._batman).validators||(h.validators=[]);if(typeof e=="function")return g.push({keys:a,callback:e});d=e,l=[];for(j=0,k=C.length;j<k;j++)f=C[j],l.push(function(){var e,h;if(c=f.matches(d)){for(e=0,h=c.length;e<h;e++)b=c[e],delete d[b];return g.push({keys:a,validator:new f(c)})}}());return l},m.classAccessor("all",{get:function(){var a;return this.prototype.hasStorage()&&(a=this.classState())!=="loaded"&&a!=="loading"&&this.load(),this.get("loaded")},set:function(a,b){return this.set("loaded",b)}}),m.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new A.Set)},set:function(a,b){return this._loaded=b}}),m.classAccessor("first",function(){return this.get("all").toArray()[0]}),m.classAccessor("last",function(){var a;return a=this.get("all").toArray(),a[a.length-1]}),m.find=function(a,b){var c,d;return d=new this,d.set("id",a),c=this._mapIdentity(d),c.load(b),c},m.load=function(a,b){return w(a)==="Function"&&(b=a,a={}),this.loading(),this.prototype._doStorageOperation("readAll",a,ba(function(a,c){var d,e;return a!=null?typeof b=="function"?b(a,[]):void 0:(d=function(){var a,b,d;d=[];for(a=0,b=c.length;a<b;a++)e=c[a],d.push(this._mapIdentity(e));return d}.call(this),this.loaded(),typeof b=="function"?b(a,d):void 0)},this))},m.create=function(a,b){var c,d;return b||(d=[{},a],a=d[0],b=d[1]),c=new this(a),c.save(b),c},m.findOrCreate=function(a,b){var c,d;return d=new this(a),d.isNew()?d.save(b):(c=this._mapIdentity(d),c.updateAttributes(a),b(void 0,c))},m._mapIdentity=function(a){var b,c,d;return typeof (c=a.get("id"))=="undefined"||c===""?a:(b=(d=this.get("loaded.indexedBy.id").get(c))!=null?d.toArray()[0]:void 0,b?(b.updateAttributes(a._batman.attributes||{}),b):(this.get("loaded").add(a),a))},j=["belongsTo","hasOne","hasMany"],b=ba(function(a){return this[a]=function(b,c){var d,e;return this._batman.check(this),d=(e=this._batman).associations||(e.associations=new A.AssociationCollection(this)),d.add(new A.Association[a](this,b,c))}},m);for(c=0,f=j.length;c<f;c++)a=j[c],b(a);m.accessor("id",{get:function(){var a;return a=this.constructor.primaryKey,a==="id"?this.id:this.get(a)},set:function(a,b){var c,d;return typeof b=="string"&&!isNaN(c=parseInt(b,10))&&(b=c),d=this.constructor.primaryKey,d==="id"?this.id=b:this.set(d,b)}}),m.accessor("dirtyKeys","errors",A.Property.defaultAccessor),m.accessor("batmanState",{get:function(){return this.state()},set:function(a,b){return this.state(b)}}),m.accessor(m.defaultAccessor={get:function(a){var b;return((b=this._batman).attributes||(b.attributes={}))[a]||this[a]},set:function(a,b){var c;return((c=this._batman).attributes||(c.attributes={}))[a]=b},unset:function(a){var b,c;return b=((c=this._batman).attributes||(c.attributes={}))[a],delete this._batman.attributes[a],b}}),m.prototype.set=function(a,b){var c,d,e;c=this.get(a);if(c===b)return;return d=m.__super__.set.apply(this,arguments),this.dirtyKeys.set(a,c),(e=this.state())!=="dirty"&&e!=="loading"&&e!=="creating"&&this.dirty(),d},m.prototype.updateAttributes=function(a){return this.mixin(a),this},m.prototype.toString=function(){return""+h(this.constructor)+": "+this.get("id")},m.prototype.toJSON=function(){var a,b;return b={},a=this._batman.get("encoders"),!!a&&!a.isEmpty()&&a.forEach(ba(function(a,c){var d,e;e=this.get(a);if(typeof e!="undefined"){d=c(e,a,b,this);if(typeof d!="undefined")return b[a]=d}},this)),b},m.prototype.fromJSON=function(a){var b,c,d,e;d={},b=this._batman.get("decoders");if(!b||b.isEmpty())for(c in a)e=a[c],d[c]=e;else b.forEach(ba(function(b,c){if(a[b])return d[b]=c(a[b],b,a,d,this)},this));return this.mixin(d)},m.actsAsStateMachine(!0),k=["empty","dirty","loading","loaded","saving","saved","creating","created","validating","validated","destroying","destroyed"];for(d=0,g=k.length;d<g;d++)a=k[d],m.state(a);l=["loading","loaded"];for(e=0,i=l.length;e<i;e++)a=l[e],m.classState(a);return m.prototype._doStorageOperation=function(a,b,c){var d,e,f,g;e=this._batman.get("storage");for(f=0,g=e.length;f<g;f++)d=e[f],d[a](this,b,c);return!0},m.prototype.hasStorage=function(){return(this._batman.get("storage")||[]).length>0},m.prototype.load=function(a){var b;if((b=this.state())==="destroying"||b==="destroyed"){typeof a=="function"&&a(new Error("Can't load a destroyed record!"));return}return this.loading(),this._doStorageOperation("read",{},ba(function(b,c){return b||(this.loaded(),c=this.constructor._mapIdentity(c)),typeof a=="function"?a(b,c):void 0},this))},m.prototype.save=function(a){var b;if((b=this.state())==="destroying"||b==="destroyed"){typeof a=="function"&&a(new Error("Can't save a destroyed record!"));return}return this.validate(ba(function(b,c){var d,e,f,g;if(!b){typeof a=="function"&&a(c);return}return e=this.isNew(),this.saving(),e&&this.creating(),d=(f=this.constructor._batman.associations)!=null?f.getAll():void 0,d!=null&&(g=d.get("belongsTo"))!=null&&g.forEach(ba(function(a,b){return a.apply(this)},this)),this._doStorageOperation(e?"create":"update",{},ba(function(b,c){var f,g;return b||(e&&this.created(),this.saved(),this.dirtyKeys.clear(),d!=null&&(f=d.get("hasOne"))!=null&&f.forEach(function(a){return a.apply(b,c)}),d!=null&&(g=d.get("hasMany"))!=null&&g.forEach(function(a){return a.apply(b,c)}),c=this.constructor._mapIdentity(c)),typeof a=="function"?a(b,c):void 0},this))},this))},m.prototype.destroy=function(a){return this.destroying(),this._doStorageOperation("destroy",{},ba(function(b,c){return b||(this.constructor.get("all").remove(this),this.destroyed()),typeof a=="function"?a(b):void 0},this))},m.prototype.validate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;e=this.state(),this.errors.clear(),this.validating(),c=ba(function(){return this.validated(),this[e](),typeof a=="function"?a(this.errors.length===0,this.errors):void 0},this),i=this._batman.get("validators")||[];if(i.length>0){b=i.length,g=ba(function(){if(--b===0)return c()},this);for(j=0,k=i.length;j<k;j++){h=i[j],f=h.validator,n=h.keys;for(m=0,l=n.length;m<l;m++)d=n[m],f?f.validateEach(this.errors,this,d,g):h.callback(this.errors,this,d,g)}}else c()},m.prototype.isNew=function(){return typeof this.get("id")=="undefined"},m}.call(this),A.AssociationCollection=function(){function a(a){this.model=a,this.storage=new A.SimpleHash}return a.availableAssociations=["belongsTo","hasOne","hasMany"],a.prototype.add=function(a){var b;return(b=this.storage.get(a.constructor))||(b=new A.SimpleHash,this.storage.set(a.associationType,b)),b.set(a,a.label)},a.prototype.get=function(a){return this.storage.get(a)},a.prototype.getAll=function(){var a,b,c,d,e,f,g,h,i,j;this.model._batman.check(this.model),b=this.model._batman.ancestors(function(a){return a._batman.get("associations")}),e=new A.SimpleHash,i=A.AssociationCollection.availableAssociations;for(g=0,h=i.length;g<h;g++)d=i[g],c=function(){var c,e,g;g=[];for(c=0,e=b.length;c<e;c++)a=b[c],a!=null&&(f=a.get(d))&&g.push(f);return g}(),e.set(d,(j=this.storage.get(d)||new A.SimpleHash).merge.apply(j,c));return this.storage=e,this.getAll=function(){return this.storage},this.storage},a}(),A.Association=function(){function b(a,b,c){var d,e,f;this.model=a,this.label=b,c==null&&(c={}),d={namespace:A.currentApp,name:J.camelize(J.singularize(this.label))},this.options=m(d,this.defaultOptions,c),a.encode(b,this.encoder()),f=this,e=function(){return f.getAccessor.call(this,f,a,b)},a.accessor(b,{get:e,set:a.defaultAccessor.set,unset:a.defaultAccessor.unset})}var a;return b.prototype.associationType="",b.prototype.defaultOptions={saveInline:!0,autoload:!0},a=function(){function a(b){this.association=b,a.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),this.association.foreignKey)}return _(a,A.SetIndex),a.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,ba(function(){return new A.Association.Set(a,this.association)},this))},a}(),b.prototype.setIndex=function(){return this.index||(this.index=new a(this)),this.index},b.prototype.getRelatedModel=function(){var a,b;return b=this.options.namespace||A.currentApp,a=this.options.name,b!=null?b[a]:void 0},b.prototype.getFromAttributes=function(a){return a.constructor.defaultAccessor.get.call(a,this.label)},b.prototype.getAccessor=function(){},b.prototype.encoder=function(){},b}(),A.Association.belongsTo=function(){function a(){a.__super__.constructor.apply(this,arguments),this.model.encode(""+this.label+"_id")}return _(a,A.Association),a.prototype.associationType="belongsTo",a.prototype.defaultOptions={saveInline:!1,autoload:!0},a.prototype.getAccessor=function(a,b,c){var d,e,f,g;if(g=a.getFromAttributes(this))return g;if(!(e=this.get(""+c+"_id")))return;if(!(f=a.getRelatedModel()))return;return d=a.setIndex().get(e),d.isEmpty()?a.options.autoload?f.find(e,function(a,b){if(a)throw a}):new f(e):d.toArray()[0]},a.prototype.encoder=function(){var a;return a=this,{encode:function(b){if(!a.options.saveInline)return;return b.toJSON()},decode:function(b){var c;return c=new(a.getRelatedModel()),c.fromJSON(b),c}}},a.prototype.apply=function(a){var b;if(b=a.get(this.label))return a.set(""+this.label+"_id",b.get("id"))},a}(),A.Association.hasOne=function(){function a(){a.__super__.constructor.apply(this,arguments),this.propertyName=h(this.model).toLowerCase(),this.foreignKey=""+J.underscore(h(this.model))+"_id"}return _(a,A.Association),a.prototype.associationType="hasOne",a.prototype.getAccessor=function(a,b,c){var d,e,f,g,h;if(this.amSetting)return;if(d=a.getFromAttributes(this))return d;if(!(g=a.getRelatedModel()))return;if(!(e=this.get("id")))return;return h=a.setIndex().get(e),h.isEmpty()?(f=new g,f.load=function(b){var c;return c={},c[a.foreignKey]=e,g.load(c,ba(function(a,c){if(!a){if(!c||c.length<=0)return b(new Error("Couldn't find related record!"));this.fromJSON(c[0].toJSON())}return b(void 0,c[0])},this))},this.amSetting=!0,this.set(c,f),this.amSetting=!1,a.options.autoload&&f.load(function(a){}),f):h.toArray()[0]},a.prototype.apply=function(a,b){var c;if(c=b.constructor.defaultAccessor.get.call(b,this.label))return c.set(this.foreignKey,b.get("id"))},a.prototype.encoder=function(){var a;return a=this,{encode:function(b,c,d,e){var f;if(!a.options.saveInline)return;return f=b.toJSON(),f[a.foreignKey]=e.get("id"),f},decode:function(b){var c;return c=new(a.getRelatedModel()),c.fromJSON(b),c}}},a}(),A.Association.hasMany=function(){function a(){a.__super__.constructor.apply(this,arguments),this.propertyName=h(this.model).toLowerCase(),this.foreignKey=""+J.underscore(h(this.model))+"_id"}return _(a,A.Association),a.prototype.associationType="hasMany",a.prototype.getAccessor=function(a,b,c){var d,e,f,g;if(this.amSetting)return;if(!(f=a.getRelatedModel()))return;if(e=a.getFromAttributes(this))return e;if(!(d=this.get("id")))return;return g=a.setIndex().get(d),this.amSetting=!0,this.set(c,g),this.amSetting=!1,a.options.autoload&&g.isEmpty()&&g.load(function(a,b){if(a)throw a}),g},a.prototype.apply=function(a,b){var c;if(c=b.constructor.defaultAccessor.get.call(b,this.label))return c.forEach(ba(function(a){return a.set(this.foreignKey,b.get("id"))},this))},a.prototype.encoder=function(){var a;return a=this,{encode:function(b,c,c,d){var e;if(!a.options.saveInline)return;return b!=null&&(e=[],b.forEach(function(b){var c;return c=b.toJSON(),c[a.foreignKey]=d.get("id"),e.push(c)})),e},decode:function(b){var c,d,e,f,g,h;f=new A.Set;if(e=a.getRelatedModel())for(g=0,h=b.length;g<h;g++)c=b[g],d=new e(c),d=e._mapIdentity(d),f.add(d);return f}}},a}(),A.Association.Set=function(){function a(b,c){this.key=b,this.association=c,a.__super__.constructor.call(this)}return _(a,A.Set),a.prototype.load=function(a){var b;return b={},b[this.association.foreignKey]=this.key,this.association.getRelatedModel().load(b,ba(function(b){return a(b,this)},this))},a}(),A.ValidationError=function(){function a(b,c){a.__super__.constructor.call(this,{attribute:b,message:c})}return _(a,A.Object),a}(),A.ErrorsSet=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Set),a.accessor(function(a){return this.indexedBy("attribute").get(a)}),a.prototype.add=function(b,c){return a.__super__.add.call(this,new A.ValidationError(b,c))},a}(),A.Validator=function(){function a(){var b,c;c=arguments[0],b=2>arguments.length?[]:X.call(arguments,1),this.options=c,a.__super__.constructor.apply(this,b)}return _(a,A.Object),a.prototype.validate=function(a){},a.prototype.format=function(a,b,c){return N("errors.format",{attribute:a,message:N("errors.messages."+b,c)})},a.options=function(){var a;return a=1>arguments.length?[]:X.call(arguments,0),A.initializeObject(this),this._batman.options?this._batman.options.concat(a):this._batman.options=a},a.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._batman)!=null?(g=f.options)!=null?g.indexOf(b):void 0:void 0)&&(c[b]=e,d=!0);if(d)return c},a}(),C=A.Validators=[A.LengthValidator=function(){function a(b){var c;if(c=b.lengthIn||b.lengthWithin)b.minLength=c[0],b.maxLength=c[1]||-1,delete b.lengthWithin,delete b.lengthIn;a.__super__.constructor.apply(this,arguments)}return _(a,A.Validator),a.options("minLength","maxLength","length","lengthWithin","lengthIn"),a.prototype.validateEach=function(a,b,c,d){var e,f;return e=this.options,f=b.get(c),e.minLength&&f.length<e.minLength&&a.add(c,this.format(c,"too_short",{count:e.minLength})),e.maxLength&&f.length>e.maxLength&&a.add(c,this.format(c,"too_long",{count:e.maxLength})),e.length&&f.length!==e.length&&a.add(c,this.format(c,"wrong_length",{count:e.length})),d()},a}(),A.PresenceValidator=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Validator),a.options("presence"),a.prototype.validateEach=function(a,b,c,d){var e;return e=b.get(c),this.options.presence&&e==null&&a.add(c,this.format(c,"blank")),d()},a}()],m(A.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank"}}}),A.StorageAdapter=function(){function k(a){k.__super__.constructor.call(this,{model:a})}var a,b,c,d,e,f,g,i,j;_(k,A.Object),k.prototype.isStorageAdapter=!0,k.prototype.modelKey=function(a){var b;return b=(a!=null?a.constructor:void 0)||this.model,b.get("storageKey")||J.pluralize(J.underscore(h(b)))},k.prototype._batman.check(k.prototype),i=["all","create","read","readAll","update","destroy"];for(d=0,f=i.length;d<f;d++){a=i[d],j=["before","after"],c=ba(function(a,b){var c;return c=""+b+J.capitalize(a),this.prototype[c]=function(a){var b,d;return this._batman.check(this),((b=this._batman)[d=""+c+"Filters"]||(b[d]=[])).push(a)}},k);for(e=0,g=j.length;e<g;e++)b=j[e],c(a,b)}return k.prototype.before=function(){var a,b,c,d,e,f,g;c=2>arguments.length?(d=0,[]):X.call(arguments,0,d=arguments.length-1),a=arguments[d++],g=[];for(e=0,f=c.length;e<f;e++)b=c[e],g.push(this["before"+J.capitalize(b)](a));return g},k.prototype.after=function(){var a,b,c,d,e,f,g;c=2>arguments.length?(d=0,[]):X.call(arguments,0,d=arguments.length-1),a=arguments[d++],g=[];for(e=0,f=c.length;e<f;e++)b=c[e],g.push(this["after"+J.capitalize(b)](a));return g},k.prototype._filterData=function(){var a,b,c;return c=arguments[0],a=arguments[1],b=3>arguments.length?[]:X.call(arguments,2),(this._batman.get(""+c+J.capitalize(a)+"Filters")||[]).concat(this._batman.get(""+c+"AllFilters")||[]).reduce(ba(function(a,b){return b.call(this,a)},this),b)},k.prototype.getRecordFromData=function(a){var b;return b=new this.model,b.fromJSON(a),b},k}.call(this),o=function(a){return function(b){var c;return b[0]?b:(c=b.shift(),b=a.call(this,b),b.unshift(c),b)}},A.LocalStorage=function(){function a(){if(typeof window.localStorage=="undefined")return null;a.__super__.constructor.apply(this,arguments),this.storage=localStorage;return}return _(a,A.StorageAdapter),a.prototype.storageRegExp=function(a){return new RegExp("^"+this.modelKey(a)+"(\\d+)$")},a.prototype.idForRecord=function(a){var b,c;return c=this.storageRegExp(a),b=1,this._forAllRecords(function(a,d){var e;if(e=c.exec(a))return b=Math.max(b,parseInt(e[1],10)+1)}),b},a.prototype.before("create","update",o(function(a){var b,c;return c=a[0],b=a[1],[JSON.stringify(c),b]})),a.prototype.after("read",o(function(a){var b,c,d;return d=a[0],b=a[1],c=a[2],[d.fromJSON(JSON.parse(b)),b,c]})),a.prototype._forAllRecords=function(a){var b,c,d,e;e=[];for(b=0,d=this.storage.length;0>d?b>d:b<d;0>d?b--:b++)c=this.storage.key(b),e.push(a.call(this,c,this.storage.getItem(c)));return e},a.prototype.getRecordFromData=function(b){var c;return c=a.__super__.getRecordFromData.apply(this,arguments),this.nextId=Math.max(this.nextId,parseInt(c.get("id"),10)+1),c},a.prototype.update=function(a,b,c){var d,e,f,g;return g=this._filterData("before","update",void 0,a,b),d=g[0],f=g[1],d||(e=a.get("id"),e!=null?this.storage.setItem(this.modelKey(a)+e,f):d=new Error("Couldn't get record primary key.")),c.apply(null,this._filterData("after","update",d,a,b))},a.prototype.create=function(a,b,c){var d,e,f,g,h;return h=this._filterData("before","create",void 0,a,b),d=h[0],g=h[1],d||(e=a.get("id")||a.set("id",this.idForRecord(a)),e!=null?(f=this.modelKey(a)+e,this.storage.getItem(f)?d=new Error("Can't create because the record already exists!"):this.storage.setItem(f,g)):d=new Error("Couldn't set record primary key on create!")),c.apply(null,this._filterData("after","create",d,a,b))},a.prototype.read=function(a,b,c){var d,e,f,g;return g=this._filterData("before","read",void 0,a,b),e=g[0],a=g[1],f=a.get("id"),e||(f!=null?(d=this.storage.getItem(this.modelKey(a)+f),d||(e=new Error("Couldn't find record!"))):e=new Error("Couldn't get record primary key.")),c.apply(null,this._filterData("after","read",e,a,d,b))},a.prototype.readAll=function(a,b,c){var d,e,f,g;return f=[],g=this._filterData("before","readAll",void 0,b),d=g[0],b=g[1],d||(e=this.storageRegExp(a),this._forAllRecords(function(a,b){var c;if(c=e.exec(a))return f.push({data:b,id:c[1]})})),c.apply(null,this._filterData("after","readAll",d,f,b))},a.prototype.after("readAll",o(function(a){var b,c,d,e;return b=a[0],e=a[1],b=function(){var a,e,f,g;g=[];for(a=0,e=b.length;a<e;a++)c=b[a],d=JSON.parse(c.data),d[f=this.model.primaryKey]||(d[f]=parseInt(c.id,10)),g.push(d);return g}.call(this),[b,e]})),a.prototype.after("readAll",o(function(a){var b,c,d,e,f,g,h,i,j;b=a[0],g=a[1],f=[];for(i=0,j=b.length;i<j;i++){c=b[i],e=!0;for(d in g){h=g[d];if(c[d]!==h){e=!1;break}}e&&f.push(c)}return[f,g]})),a.prototype.after("readAll",o(function(a){var b,c,d;return c=a[0],d=a[1],[function(){var a,d,e;e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push(this.getRecordFromData(b));return e}.call(this),c,d]})),a.prototype.destroy=function(a,b,c){var d,e,f,g;return g=this._filterData("before","destroy",void 0,a,b),d=g[0],a=g[1],d||(e=a.get("id"),e!=null?(f=this.modelKey(a)+e,this.storage.getItem(f)?this.storage.removeItem(f):d=new Error("Can't delete nonexistant record!")):d=new Error("Can't delete record without an primary key!")),c.apply(null,this._filterData("after","destroy",d,a,b))},a}(),A.RestStorage=function(){function a(){a.__super__.constructor.apply(this,arguments),this.defaultOptions=m({},this.defaultOptions)}return _(a,A.StorageAdapter),a.prototype.defaultOptions={type:"json"},a.prototype.recordJsonNamespace=!1,a.prototype.collectionJsonNamespace=!1,a.prototype.serializeAsForm=!0,a.prototype.recordJsonNamespace=function(a){return J.singularize(this.modelKey(a))},a.prototype.collectionJsonNamespace=function(a){return J.pluralize(this.modelKey(a))},a.prototype.before("create","update",o(function(a){var b,c,d,e,f;return e=a[0],d=a[1],b=e.toJSON(),e=(c=this.recordJsonNamespace(e))?(f={},f[c]=b,f):b,this.serializeAsForm||(e=JSON.stringify(e)),[e,d]})),a.prototype.after("create","read","readAll","update","destroy",function(a){var b,c,d,e;c=a[0],e=a[1],b=a[2],d=a[3];if(!c&&typeof b=="string")try{b=JSON.parse(b)}catch(f){c=f}return[c,e,b,d]}),a.prototype.after("create","read","update",o(function(a){var b,c,d,e;return e=a[0],b=a[1],d=a[2],c=this.recordJsonNamespace(e),c&&b[c]!=null&&(b=b[c]),[e,b,d]})),a.prototype.after("create","read","update",o(function(a){var b,c,d;return d=a[0],b=a[1],c=a[2],d.fromJSON(b),[d,b,c]})),a.prototype.optionsForRecord=function(a,b,c){var d,e;if(a.url)e=typeof a.url=="function"?a.url(b):a.url;else{e=a.constructor.url?typeof a.constructor.url=="function"?a.constructor.url(b):a.constructor.url:"/"+this.modelKey(a);if(b.idRequired){d=a.get("id");if(d==null){c.call(this,new Error("Couldn't get record primary key!"));return}e=e+"/"+d}}return e?c.call(this,void 0,m({},this.defaultOptions,{url:e})):c.call(this,new Error("Couldn't get model url!"))},a.prototype.optionsForCollection=function(a,b,c){var d;return a.url?d=typeof a.url=="function"?a.url(b):a.url:d="/"+this.modelKey(a.prototype),d?c.call(this,void 0,m({},this.defaultOptions,{url:d,data:m({},this.defaultOptions.data,b)})):c.call(this,new Error("Couldn't get collection url!"))},a.prototype.create=function(a,b,c){return this.optionsForRecord(a,{idRequired:!1},function(d,e){var f,g;g=this._filterData("before","create",d,a,b),d=g[0],f=g[1];if(d){c(d);return}return new A.Request(m(e,{data:f,method:"POST",success:ba(function(d){return c.apply(null,this._filterData("after","create",void 0,a,d,b))},this),error:ba(function(d){return c.apply(null,this._filterData("after","create",d,a,d.request.get("response"),b))},this)}))})},a.prototype.update=function(a,b,c){return this.optionsForRecord(a,{idRequired:!0},function(d,e){var f,g;g=this._filterData("before","update",d,a,b),d=g[0],f=g[1];if(d){c(d);return}return new A.Request(m(e,{data:f,method:"PUT",success:ba(function(d){return c.apply(null,this._filterData("after","update",void 0,a,d,b))},this),error:ba(function(d){return c.apply(null,this._filterData("after","update",d,a,d.request.get("response"),b))},this)}))})},a.prototype.read=function(a,b,c){return this.optionsForRecord(a,{idRequired:!0},function(d,e){var f;f=this._filterData("before","read",d,a,b),d=f[0],a=f[1],b=f[2];if(d){c(d);return}return new A.Request(m(e,{data:b,method:"GET",success:ba(function(d){return c.apply(null,this._filterData("after","read",void 0,a,d,b))},this),error:ba(function(d){return c.apply(null,this._filterData("after","read",d,a,d.request.get("response"),b))},this)}))})},a.prototype.readAll=function(a,b,c){return this.optionsForCollection(a.constructor,b,function(d,e){var f;f=this._filterData("before","readAll",d,b),d=f[0],b=f[1];if(d){c(d);return}return b&&b.url&&(e.url=b.url,delete b.url),new A.Request(m(e,{data:b,method:"GET",success:ba(function(d){return c.apply(null,this._filterData("after","readAll",void 0,d,a,b))},this),error:ba(function(d){return c.apply(null,this._filterData("after","readAll",d,d.request.get("response"),a,b))},this)}))})},a.prototype.after("readAll",o(function(a){var b,c,d,e,f;return b=a[0],e=a[1],d=a[2],c=this.collectionJsonNamespace(e),f=c&&b[c]!=null?b[c]:b,[f,b,e,d]})),a.prototype.after("readAll",o(function(a){var b,c,d,e,f;return e=a[0],f=a[1],d=a[2],c=a[3],[function(){var a,c,d;d=[];for(a=0,c=e.length;a<c;a++)b=e[a],d.push(this.getRecordFromData(b));return d}.call(this),f,d,c]})),a.prototype.destroy=function(a,b,c){return this.optionsForRecord(a,{idRequired:!0},function(d,e){var f;f=this._filterData("before","destroy",d,a,b),d=f[0],a=f[1],b=f[2];if(d){c(d);return}return new A.Request(m(e,{method:"DELETE",success:ba(function(d){return c.apply(null,this._filterData("after","destroy",void 0,a,d,b))},this),error:ba(function(d){return c.apply(null,this._filterData("after","destroy",d,a,d.request.get("response"),b))},this)}))})},a}(),A.ViewSourceCache=function(){function a(){a.__super__.constructor.apply(this,arguments),this.sources={},this.requests={}}return _(a,A.Object),a.prototype.propertyClass=A.Property,a.accessor({get:function(a){a=A.Navigator.normalizePath(a);if(this.sources[a]!=null)return this.sources[a];this.requests[a]==null&&(this.requests=new A.Request({url:a+".html",type:"html",success:ba(function(b){return this.set(a,b)},this),error:function(b){throw new Error("Could not load view from "+a)}}))},set:function(a,b){return this.sources[a]=b}}),a.prototype.prefetch=function(a){return this.get(a),!0},a}(),A.View=function(){function a(){var b,c;this.contexts=[],a.__super__.constructor.apply(this,arguments);if(b=this.get("context"))this.contexts.push(b),this.unset("context");(c=this.get("node"))?this.render(c):this.observe("node",ba(function(a){return this.render(a)},this))}return _(a,A.Object),a.sourceCache=new A.ViewSourceCache,a.prototype.source="",a.prototype.html="",a.prototype.node=null,a.prototype.contentFor=null,a.prototype.event("ready").oneShot=!0,a.prototype.prefix="views",a.accessor("html",{get:function(){var a,b;if(this.html&&this.html.length>0)return this.html;b=this.get("source");if(!b)return;return a=A.Navigator.normalizePath(this.prefix,b),this.html=this.constructor.sourceCache.get(a)},set:function(a,b){return this.html=b}}),a.accessor("node",{get:function(){var a;if(!this.node){a=this.get("html");if(!a||a.length<=0)return;this.node=document.createElement("div"),u(this.node,a)}return this.node},set:function(a,b){return this.node=b}}),a.prototype.render=function(a){this.event("ready").resetOneShot(),this._renderer&&this._renderer.forgetAll();if(a)return this._renderer=new A.Renderer(a,ba(function(){var c,d;d=this.contentFor,typeof d=="string"&&(this.contentFor=A.DOM._yields[d]);if(this.contentFor&&a)return u(this.contentFor,""),b(this.contentFor,a);if(d)return(c=A.DOM._yieldContents[d])?c.push(a):A.DOM._yieldContents[d]=[a]},this),this.contexts),this._renderer.on("rendered",ba(function(){return this.fire("ready",a)},this))},a}(),A.Renderer=function(){function i(a,b,c){var d;this.node=a,c==null&&(c=[]),this.resume=ba(this.resume,this),this.start=ba(this.start,this),i.__super__.constructor.call(this),b!=null&&this.on("parsed",b),this.context=c instanceof A.RenderContext?c:(d=A.RenderContext).start.apply(d,c),this.immediate=t(this.start)}var a,b,c,e,f,h;_(i,A.Object),i.prototype.deferEvery=50,i.prototype.start=function(){return this.startTime=new Date,this.parseNode(this.node)},i.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},i.prototype.finish=function(){return this.startTime=null,this.fire("parsed"),this.fire("rendered")},i.prototype.stop=function(){return d(this.immediate),this.fire("stopped")},i.prototype.forgetAll=function(){},h=["parsed","rendered","stopped"];for(e=0,f=h.length;e<f;e++)b=h[e],i.prototype.event(b).oneShot=!0;return a=/^data\-(.*)/,c=function(a,b){return a[0]==="foreach"?-1:b[0]==="foreach"?1:a[0]==="formfor"?-1:b[0]==="formfor"?1:a[0]==="bind"?-1:b[0]==="bind"?1:0},i.prototype.parseNode=function(b){var d,e,f,g,h,i,j,k,l,m,o,p,q,r,s,u,v;if(this.deferEvery&&new Date-this.startTime>this.deferEvery){this.resumeNode=b,this.timeout=t(this.resume);return}if(b.getAttribute&&b.attributes){e=function(){var c,e,f,h,i;f=b.attributes,i=[];for(c=0,e=f.length;c<e;c++){d=f[c],g=(h=d.nodeName.match(a))!=null?h[1]:void 0;if(!g)continue;i.push(~(m=g.indexOf("-"))?[g.substr(0,m),g.substr(m+1),d.value]:[g,d.value])}return i}(),v=e.sort(c);for(q=0,r=v.length;q<r;q++){j=v[q],f=j[1],k=j.length===2?typeof (o=A.DOM.readers)[s=j[0]]=="function"?o[s](b,f,this.context,this):void 0:typeof (p=A.DOM.attrReaders)[u=j[0]]=="function"?p[u](b,f,j[2],this.context,this):void 0;if(k===!1){l=!0;break}k instanceof A.RenderContext&&(i=this.context,this.context=k,n(b,ba(function(){return this.context=i},this)))}}return(h=this.nextNode(b,l))?this.parseNode(h):this.finish()},i.prototype.nextNode=function(a,b){var c,d,e,f;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}f=a.nextSibling,n(a).forEach(function(a){return a()}),g(a);if(this.node===a)return;if(f)return f;d=a;while(d=d.parentNode){n(d).forEach(function(a){return a()}),g(d);if(this.node===d)return;e=d.nextSibling;if(e)return e}},i}(),A.RenderContext=function(){function b(a,b){this.object=a,this.parent=b}var a;return b.start=function(){var a,b,c;b=1>arguments.length?[]:X.call(arguments,0),c=new this(window),A.currentApp&&b.push(A.currentApp);while(a=b.pop())c=c.descend(a);return c},b.prototype.findKey=function(a){var b,c,d;b=a.split(".")[0].split("|")[0].trim(),c=this;while(c){c.object.get!=null?d=c.object.get(b):d=c.object[b];if(typeof d!="undefined")return[i(c.object,a),c.object];c=c.parent}return[G.get(a),G]},b.prototype.descend=function(a,b){var c;return b&&(c=a,a=new A.Object,a[b]=c),new this.constructor(a,this)},b.prototype.descendWithKey=function(b,c){var d;return d=new a(this,b),this.descend(d,c)},b.prototype.chain=function(){var a,b;b=[],a=this;while(a)b.push(a.object),a=a.parent;return b},b.ContextProxy=a=function(){function a(a,b,c){this.renderContext=a,this.keyPath=b,this.localKey=c,this.binding=new A.DOM.AbstractBinding(void 0,this.keyPath,this.renderContext)}return _(a,A.Object),a.prototype.isContextProxy=!0,a.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),a.accessor({get:function(a){return this.get("proxiedObject."+a)},set:function(a,b){return this.set("proxiedObject."+a,b)},unset:function(a){return this.unset("proxiedObject."+a)}}),a}(),b}.call(this),A.DOM={readers:{target:function(a,b,c,d){return A.DOM.readers.bind(a,b,c,d,"nodeChange"),!0},source:function(a,b,c,d){return A.DOM.readers.bind(a,b,c,d,"dataChange"),!0},bind:function(a,b,c,d,e){var f;f=!1;switch(a.nodeName.toLowerCase()){case"input":switch(a.getAttribute("type")){case"checkbox":return A.DOM.attrReaders.bind(a,"checked",b,c,d,e),!0;case"radio":f=A.DOM.RadioBinding;break;case"file":f=A.DOM.FileBinding}break;case"select":f=A.DOM.SelectBinding}return f||(f=A.DOM.Binding),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(f,arguments,function(){}),!0},context:function(a,b,c,d){return c.descendWithKey(b)},mixin:function(a,b,c,d){return new A.DOM.MixinBinding(a,b,c.descend(A.mixins),d),!0},showif:function(a,b,c,d,e){return new A.DOM.ShowHideBinding(a,b,c,d,!1,e),!0},hideif:function(){var a;return(a=A.DOM.readers).showif.apply(a,X.call(arguments).concat([!0]))},route:function(a,b,c){var d,e,f,g,i,j,k,l,m,n,o;if(b.substr(0,1)==="/")l=b;else{i=b.indexOf("#")>1,m=i?b.split("#"):b.split("/"),b=m[0],d=m[1],n=c.findKey("dispatcher"),g=n[0],e=n[1],i||(o=c.findKey(b),j=o[0],f=o[1]),g||(g=A.currentApp.dispatcher);if(i)l=g.findUrl({controller:b,action:d});else if(j instanceof A.Model)d||(d="show"),k=J.underscore(J.pluralize(h(j.constructor))),l=g.findUrl({resource:k,id:j.get("id"),action:d});else if(j!=null?j.prototype:void 0)d||(d="index"),k=J.underscore(J.pluralize(h(j))),l=g.findUrl({resource:k,action:d})}if(!l)return;return a.nodeName.toUpperCase()==="A"&&(a.href=A.Navigator.defaultClass().prototype.linkTo(l)),A.DOM.events.click(a,function(){return q(l)}),!0},partial:function(a,b,c,d){var e;return d.prevent("rendered"),e=new A.View({source:b,contentFor:a,contexts:c.chain()}),e.on("ready",function(){return d.allowAndFire("rendered")}),!0},defineview:function(a,b,c,d){return n(a,function(){return s(a)}),A.View.sourceCache.set(A.Navigator.normalizePath(A.View.prototype.prefix,b),a.innerHTML),!1},yield:function(a,b){return t(function(){return A.DOM.yield(b,a)}),!0},contentfor:function(a,b){return t(function(){return A.DOM.contentFor(b,a)}),!0},replace:function(a,b){return t(function(){return A.DOM.replace(b,a)}),!0}},_yieldContents:{},_yields:{},attrReaders:{_parseAttribute:function(a){return a==="false"&&(a=!1),a==="true"&&(a=!0),a},source:function(a,b,c,d,e){return A.DOM.attrReaders.bind(a,b,c,d,e,"dataChange")},bind:function(a,b,c,d,e,f){var g;return g=function(){switch(b){case"checked":case"disabled":case"selected":return A.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return A.DOM.NodeAttributeBinding;case"class":return A.DOM.ClassBinding;case"style":return A.DOM.StyleBinding;default:return A.DOM.AttributeBinding}}(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(g,arguments,function(){}),!0},context:function(a,b,c,d){return d.descendWithKey(c,b)},event:function(a,b,c,d){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(A.DOM.EventBinding,arguments,function(){}),!0},addclass:function(a,b,c,d,e,f){return new A.DOM.AddClassBinding(a,b,c,d,e,!1,f),!0},removeclass:function(a,b,c,d,e){return A.DOM.attrReaders.addclass(a,b,c,d,e,!0)},foreach:function(a,b,c,d,e){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(A.DOM.IteratorBinding,arguments,function(){}),!1},formfor:function(a,b,c,d){return A.DOM.events.submit(a,function(a,b){return p(b)}),d.descendWithKey(c,b)}},events:{click:function(b,c,d){return d==null&&(d="click"),a(b,d,function(){var a;return a=1>arguments.length?[]:X.call(arguments,0),c.apply(null,[b].concat(X.call(a))),p(a[0])}),b.nodeName.toUpperCase()==="A"&&!b.href&&(b.href="#"),b},doubleclick:function(a,b){return A.DOM.events.click(a,b,"dblclick")},change:function(b,c){var d,e,f,g,h,i;e=function(){switch(b.nodeName.toUpperCase()){case"TEXTAREA":return["keyup","change"];case"INPUT":return b.type.toUpperCase()==="TEXT"?(f=c,c=function(a){var b;if(a.type!=="keyup"||13>(b=a.keyCode)||b>14)return f.apply(null,arguments);return},["keyup","change"]):["change"];default:return["change"]}}(),i=[];for(g=0,h=e.length;g<h;g++)d=e[g],i.push(a(b,d,function(){var a;return a=1>arguments.length?[]:X.call(arguments,0),c.apply(null,[b].concat(X.call(a)))}));return i},submit:function(b,c){return A.DOM.nodeIsEditable(b)?a(b,"keyup",function(){var a;a=1>arguments.length?[]:X.call(arguments,0);if(a[0].keyCode===13||a[0].which===13||a[0].keyIdentifier==="Enter"||a[0].key==="Enter")return p(a[0]),c.apply(null,[b].concat(X.call(a)))}):a(b,"submit",function(){var a;return a=1>arguments.length?[]:X.call(arguments,0),p(a[0]),c.apply(null,[b].concat(X.call(a)))}),b},other:function(b,c,d){return a(b,c,function(){var a;return a=1>arguments.length?[]:X.call(arguments,0),d.apply(null,[b].concat(X.call(a)))})}},yield:function(a,c,d){var e,f,g,h;d==null&&(d=!A.data(c,"yielded")),A.DOM._yields[a]=c;if(f=A.DOM._yieldContents[a]){d&&u(c,"",!0);for(g=0,h=f.length;g<h;g++)e=f[g],A.data(e,"yielded")||(l(c,e)&&(e=e.cloneNode(!0)),b(c,e,!0),A.data(e,"yielded",!0));return delete A.DOM._yieldContents[a],A.data(c,"yielded",!0)}},contentFor:function(a,b,c){var d,e;d=A.DOM._yieldContents[a],d?d.push(b):A.DOM._yieldContents[a]=[b];if(e=A.DOM._yields[a])return A.DOM.yield(a,e,c)},replace:function(a,b){return A.DOM.contentFor(a,b,!0)},trackBinding:v=function(a,b){var c;return(c=A.data(b,"bindings"))?c.add(a):A.data(b,"bindings",new A.SimpleSet(a))},unbindNode:x=function(a){var b,c,d,e;(b=A.data(a,"bindings"))&&b.forEach(function(a){return a.destroy()});if(e=A.data(a,"listeners"))for(d in e)c=e[d],c.forEach(function(b){return r(a,d,b)});return A.removeData(a)},unbindTree:y=function(a,b){var c,d,e,f,g;b==null&&(b=!0);if((a!=null?a.nodeType:void 0)!==1)return;b&&x(a),f=a.childNodes,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(y(c));return g},setInnerHTML:u=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=arguments[1],a=3>arguments.length?[]:X.call(arguments,2),h=e.childNodes;for(f=0,g=h.length;f<g;f++)b=h[f],(c=A.data(b,"hide"))&&c.apply(b,a);return y(e,!1),e!=null?e.innerHTML=d:void 0},removeNode:s=function(a){var b;return a!=null&&(b=a.parentNode)!=null&&b.removeChild(a),A.DOM.didRemoveNode(a)},appendChild:b=function(){var a,b,c,d;return c=arguments[0],b=arguments[1],a=3>arguments.length?[]:X.call(arguments,2),(d=A.data(b,"show"))!=null&&d.apply(b,a),c.appendChild(b)},insertBefore:k=function(a,c,d){return d==null&&(d=null),!d||a.childNodes.length<=0?b(a,c):a.insertBefore(c,d)},valueForNode:function(a,b){var c;b==null&&(b=""),c=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":return c?a.value=b:a.value;case"TEXTAREA":return c?a.innerHTML=a.value=b:a.innerHTML;case"SELECT":return a.value=b;default:return c?u(a,b):a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT"},addEventListener:a=function(a,b,c){var d;return(d=A.data(a,"listeners"))||(d=A.data(a,"listeners",{})),d[b]||(d[b]=new A.Set),d[b].add(c),j?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:r=function(a,b,c){var d,e;return(e=A.data(a,"listeners"))&&(d=e[b])&&d.remove(c),j?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},hasAddEventListener:j=typeof window!="undefined"&&window!==null?!!window.addEventListener:!!void 0,didRemoveNode:function(a){return y(a)},onParseExit:n=function(a,b){var c;return c=A.data(a,"onParseExit")||A.data(a,"onParseExit",new A.SimpleSet),b!=null&&c.add(b),c},forgetParseExit:g=function(a,b){return A.removeData(a,"onParseExit")}},A.DOM.AbstractBinding=function(){function e(a,b,c,d,e){this.node=a,this.keyPath=b,this.renderContext=c,this.renderer=d,this.only=e!=null?e:!1,this.node!=null&&A.DOM.trackBinding(this,this.node),this.parseFilter(),this.bindImmediately&&this.bind()}var a,b,c,d;return _(e,A.Object),d=/(^|,)\s*(?!(?:true|false)\s*(?:$|,))([a-zA-Z][\w\.]*[\?\!]?)\s*(?=$|,)/g,b=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,c=/(?!^\s*)\[(.*?)\]/g,a=function(a){return a instanceof A.RenderContext.ContextProxy?a.get("proxiedObject"):a},e.accessor("filteredValue",function(){var b,c;return c=this.get("unfilteredValue"),this.filterFunctions.length>0?(b=this.filterFunctions.reduce(ba(function(b,c,d){var e;return e=this.filterArguments[d].map(function(a){return a._keypath?i(a.context,a._keypath):a}),e.unshift(b),e=e.map(a),c.apply(this.renderContext,e)},this),c),b):a(c)}),e.accessor("unfilteredValue",function(){var a;return(a=this.get("key"))?this.get("keyContext."+a):this.get("value")}),e.accessor("keyContext",function(){return this.renderContext.findKey(this.key)[1]}),e.prototype.bindImmediately=!0,e.prototype.bind=function(){var a,b,c;a=!0,this.node!=null&&((b=this.only)===!1||b==="nodeChange")&&A.DOM.nodeIsEditable(this.node)&&A.DOM.events.change(this.node,ba(function(){return a=!1,typeof this.nodeChange=="function"&&this.nodeChange(this.node,this.get("keyContext")||this.value),a=!0},this));if((c=this.only)===!1||c==="dataChange")return this.observeAndFire("filteredValue",ba(function(b){if(a)return typeof this.dataChange=="function"?this.dataChange(b,this.node):void 0},this))},e.prototype.destroy=function(){var a;return this.forget(),(a=this._batman.properties)!=null?a.forEach(function(a,b){return b.removeSourceHandlers()}):void 0},e.prototype.parseFilter=function(){var a,d,e,f,g,h,i,j,k;this.filterFunctions=[],this.filterArguments=[],i=this.keyPath;while(b.test(i))i=i.replace(b,"]['$1']");g=i.replace(c," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{h=this.parseSegment(j=g.shift())[0]}catch(l){}h&&h._keypath?this.key=h._keypath:this.value=h;if(g.length){while(f=g.shift()){k=f.indexOf(" "),~k?(e=f.substr(0,k),a=f.substr(k)):e=f;if(d=A.Filters[e]){this.filterFunctions.push(d);if(a)try{this.filterArguments.push(this.parseSegment(a))}catch(l){}else this.filterArguments.push([])}}return this.filterArguments=this.filterArguments.map(ba(function(a){return a.map(ba(function(a){var b,c;return a._keypath&&(c=this.renderContext.findKey(a._keypath),b=c[0],a.context=c[1]),a},this))},this))}},e.prototype.parseSegment=function(a){return JSON.parse("["+a.replace(d,'$1{"_keypath": "$2"}')+"]")},e}(),A.DOM.AbstractAttributeBinding=function(){function a(){var b,c,d;d=arguments[0],c=arguments[1],b=3>arguments.length?[]:X.call(arguments,2),this.attributeName=c,a.__super__.constructor.apply(this,[d].concat(X.call(b)))}return _(a,A.DOM.AbstractBinding),a}(),A.DOM.AbstractCollectionBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractAttributeBinding),a.prototype.bindCollection=function(a){if(a!==this.collection){this.unbindCollection(),this.collection=a;if(this.collection){if(this.collection.isObservable&&this.collection.toArray)this.collection.observe("toArray",this.handleArrayChanged);else if(this.collection.isEventEmitter)this.collection.on("itemsWereAdded",this.handleItemsWereAdded),this.collection.on("itemsWereRemoved",this.handleItemsWereRemoved);else return!1;return!0}}return!1},a.prototype.unbindCollection=function(){if(this.collection){if(this.collection.isObservable&&this.collection.toArray)return this.collection.forget("toArray",this.handleArrayChanged);if(this.collection.isEventEmitter)return this.collection.event("itemsWereAdded").removeHandler(this.handleItemsWereAdded),this.collection.event("itemsWereRemoved").removeHandler(this.handleItemsWereRemoved)}},a.prototype.handleItemsWereAdded=function(){},a.prototype.handleItemsWereRemoved=function(){},a.prototype.handleArrayChanged=function(){},a.prototype.destroy=function(){return this.unbindCollection(),a.__super__.destroy.apply(this,arguments)},a}(),A.DOM.Binding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractBinding),a.prototype.nodeChange=function(a,b){if(this.key&&this.filterFunctions.length===0)return this.get("keyContext").set(this.key,this.node.value)},a.prototype.dataChange=function(a,b){return A.DOM.valueForNode(this.node,a)},a}(),A.DOM.AttributeBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){return this.node.setAttribute(this.attributeName,a)},a.prototype.nodeChange=function(a){return this.get("keyContext").set(this.key,A.DOM.attrReaders._parseAttribute(a.getAttribute(this.attributeName)))},a}(),A.DOM.NodeAttributeBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){return this.node[this.attributeName]=a},a.prototype.nodeChange=function(a){return this.get("keyContext").set(this.key,A.DOM.attrReaders._parseAttribute(a[this.attributeName]))},a}(),A.DOM.ShowHideBinding=function(){function a(b,c,d,e,f,g){this.invert=g!=null?g:!1,this.originalDisplay=b.style.display||"",a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractBinding),a.prototype.dataChange=function(a){var b,c;return!!a==!this.invert?((c=A.data(this.node,"show"))!=null&&c.call(this.node),this.node.style.display=this.originalDisplay):(b=A.data(this.node,"hide"),typeof b=="function"?b.call(this.node):this.node.style.display="none")},a}(),A.DOM.CheckedBinding=function(){function a(){a.__super__.constructor.apply(this,arguments),A.data(this.node,this.attributeName,this)}return _(a,A.DOM.NodeAttributeBinding),a.prototype.dataChange=function(a){var b;return this.node[this.attributeName]=!!a,typeof (b=A.data(this.node.parentNode,"updateBinding"))=="function"?b():void 0},a}(),A.DOM.ClassBinding=function(){function a(){this.handleItemsWereAdded=ba(this.handleItemsWereAdded,this),this.handleItemsWereRemoved=ba(this.handleItemsWereRemoved,this),this.handleArrayChanged=ba(this.handleArrayChanged,this),a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractCollectionBinding),a.prototype.dataChange=function(a){if(a!=null)return this.unbindCollection(),typeof a=="string"?this.node.className=a:(this.bindCollection(a),this.updateFromCollection())},a.prototype.updateFromCollection=function(){var a,b,c;if(this.collection)return a=this.collection.map?this.collection.map(function(a){return a}):function(){var a,d;a=this.collection,d=[];for(b in a){if(!Y.call(a,b))continue;c=a[b],d.push(b)}return d}.call(this),a.toArray!=null&&(a=a.toArray()),this.node.className=a.join(" ")},a.prototype.handleArrayChanged=function(){return this.updateFromCollection()},a.prototype.handleItemsWereRemoved=function(){return this.updateFromCollection()},a.prototype.handleItemsWereAdded=function(){return this.updateFromCollection()},a}(),A.DOM.AddClassBinding=function(){function a(b,c,d,e,f,g,h){this.invert=h!=null?h:!1,this.className=c.replace(/\|/g," "),a.__super__.constructor.apply(this,arguments),delete this.attributeName}return _(a,A.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){var b,c;b=this.node.className,c=b.indexOf(this.className)!==-1;if(!!a==!this.invert){if(!c)return this.node.className=""+b+" "+this.className}else if(c)return this.node.className=b.replace(this.className,"")},a}(),A.DOM.EventBinding=function(){function a(){var b,c,d;a.__super__.constructor.apply(this,arguments),d=this.node.getAttribute("data-confirm"),c=ba(function(){var a;if(d&&!confirm(d))return;return(a=this.get("filteredValue"))!=null?a.apply(this.get("callbackContext"),arguments):void 0},this),(b=A.DOM.events[this.attributeName])?b(this.node,c):A.DOM.events.other(this.node,this.attributeName,c)}return _(a,A.DOM.AbstractAttributeBinding),a.prototype.bindImmediately=!1,a.accessor("callbackContext",function(){var a,b;return b=this.key.split("."),b.pop(),a=b.length>0?this.get("keyContext").get(b.join(".")):this.get("keyContext")}),a}(),A.DOM.RadioBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractBinding),a.prototype.dataChange=function(a){var b;if((b=this.get("filteredValue"))!=null)return this.node.checked=b===this.node.value;if(this.node.checked)return this.get("keyContext").set(this.key,this.node.value)},a.prototype.nodeChange=function(a){return this.get("keyContext").set(this.key,A.DOM.attrReaders._parseAttribute(a.value))},a}(),A.DOM.FileBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractBinding),a.prototype.nodeChange=function(a,b){var c,d,e,f,g,h,i;f=this.key.split("."),f.length>1?e=b.get(f.slice(0,-1).join(".")):e=b,e instanceof A.RenderContext.ContextProxy?c=e.get("proxiedObject"):c=e;if(c.hasStorage&&c.hasStorage()){i=c._batman.get("storage");for(g=0,h=i.length;g<h;g++)d=i[g],d instanceof A.RestStorage&&(d.defaultOptions.formData=!0)}return a.hasAttribute("multiple")?b.set(this.key,Array.prototype.slice.call(a.files)):b.set(this.key,a.value)},a}(),A.DOM.MixinBinding=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractBinding),a.prototype.dataChange=function(a){if(a!=null)return m(this.node,a)},a}(),A.DOM.SelectBinding=function(){function a(){this.updateOptionBindings=ba(this.updateOptionBindings,this),this.updateSelectBinding=ba(this.updateSelectBinding,this),this.nodeChange=ba(this.nodeChange,this),this.dataChange=ba(this.dataChange,this),a.__super__.constructor.apply(this,arguments),this.renderer.on("rendered",ba(function(){if(this.node!=null)return A.data(this.node,"updateBinding",this.updateSelectBinding),this.bind()},this))}return _(a,A.DOM.AbstractBinding),a.prototype.bindImmediately=!1,a.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a instanceof Array){f={},m=this.node.children;for(g=0,j=m.length;g<j;g++)b=m[g],b.selected=!1,d=f[b.value],d?d.push(b):d=[b],f[b.value]=d;for(h=0,k=a.length;h<k;h++){e=a[h],n=f[e];for(i=0,l=n.length;i<l;i++)c=n[i],c.selected=!0}}else A.DOM.valueForNode(this.node,a);return this.updateOptionBindings()},a.prototype.nodeChange=function(){return this.updateSelectBinding(),this.updateOptionBindings()},a.prototype.updateSelectBinding=function(){var a,b;return b=this.node.multiple?function(){var b,c,d,e;d=this.node.children,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.selected&&e.push(a.value);return e}.call(this):this.node.value,b.length===1&&(b=b[0]),this.get("keyContext").set(this.key,b),!0},a.prototype.updateOptionBindings=function(){var a,b,c,d,e;e=this.node.children;for(c=0,d=e.length;c<d;c++)a=e[c],(b=A.data(a,"selected"))&&b.nodeChange(b.node);return!0},a}(),A.DOM.StyleBinding=function(){function a(){this.setStyle=ba(this.setStyle,this),this.handleItemsWereRemoved=ba(this.handleItemsWereRemoved,this),this.handleItemsWereAdded=ba(this.handleItemsWereAdded,this),this.oldStyles={},a.__super__.constructor.apply(this,arguments)}return _(a,A.DOM.AbstractCollectionBinding),a.SingleStyleBinding=function(){function a(){var b,c,d;b=2>arguments.length?(d=0,[]):X.call(arguments,0,d=arguments.length-1),c=arguments[d++],this.parent=c,a.__super__.constructor.apply(this,b)}return _(a,A.DOM.AbstractAttributeBinding),a.prototype.dataChange=function(a){return this.parent.setStyle(this.attributeName,a)},a}(),a.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(!a){this.reapplyOldStyles();return}this.unbindCollection();if(typeof a=="string"){this.reapplyOldStyles(),k=a.split(";");for(i=0,j=k.length;i<j;i++)h=k[i],l=h.split(":"),c=l[0],b=2>l.length?[]:X.call(l,1),this.setStyle(c,b.join(":"));return}if(a instanceof A.Hash){if(this.bindCollection(a))return a.forEach(ba(function(a,b){return this.setStyle(a,b)},this))}else if(a instanceof Object){this.reapplyOldStyles(),n=[];for(d in a){if(!Y.call(a,d))continue;e=a[d],m=this.renderContext.findKey(e),g=m[0],f=m[1],n.push(g?(this.bindSingleAttribute(d,e),this.setStyle(d,g)):this.setStyle(d,e))}return n}},a.prototype.handleItemsWereAdded=function(a){return this.setStyle(a,this.collection.get(a))},a.prototype.handleItemsWereRemoved=function(a){return this.setStyle(a,"")},a.prototype.bindSingleAttribute=function(a,b){return new this.constructor.SingleStyleBinding(this.node,a,b,this.renderContext,this.renderer,this.only,this)},a.prototype.setStyle=function(a,b){if(!a)return;return a=J.camelize(a.trim(),!0),this.oldStyles[a]=this.node.style[a],this.node.style[a]=b?b.trim():""},a.prototype.reapplyOldStyles=function(){var a,b,c,d;c=this.oldStyles,d=[];for(a in c){if(!Y.call(c,a))continue;b=c[a],d.push(this.setStyle(a,b))}return d},a}(),A.DOM.IteratorBinding=function(){function a(b,c,d,e,f){var g;this.iteratorName=c,this.key=d,this.context=e,this.parentRenderer=f,this.handleArrayChanged=ba(this.handleArrayChanged,this),this.handleItemsWereRemoved=ba(this.handleItemsWereRemoved,this),this.handleItemsWereAdded=ba(this.handleItemsWereAdded,this),this.nodeMap=new A.SimpleHash,this.actionMap=new A.SimpleHash,this.rendererMap=new A.SimpleHash,this.actions=[],this.prototypeNode=b.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),this.parentNode=b.parentNode,g=b.nextSibling,this.siblingNode=document.createComment("end "+this.iteratorName),k(this.parentNode,this.siblingNode,g),this.parentRenderer.on("parsed",ba(function(){return this.prototypeNode[A.expando]=b[A.expando],A.canDeleteExpando&&delete b[A.expando],s(b)},this)),this.parentRenderer.prevent("rendered"),a.__super__.constructor.call(this,this.parentNode,this.iteratorName,this.key,this.context,this.parentRenderer),this.fragment=document.createDocumentFragment(),this.bind()}return _(a,A.DOM.AbstractCollectionBinding),a.prototype.deferEvery=50,a.prototype.currentActionNumber=0,a.prototype.queuedActionNumber=0,a.prototype.bindImmediately=!1,a.prototype.destroy=function(){return x(this.prototypeNode),a.__super__.destroy.apply(this,arguments),this.destroyed=!0},a.prototype.unbindCollection=function(){if(this.collection)return this.nodeMap.forEach(function(a,b){return s(b)}),this.nodeMap.clear(),this.rendererMap.forEach(function(a,b){return b.stop()}),this.rendererMap.clear(),a.__super__.unbindCollection.apply(this,arguments)},a.prototype.dataChange=function(a){var b,c,d;this.bindCollection(a);if(this.collection)if(this.collection.toArray)this.handleArrayChanged();else if(this.collection.forEach)this.collection.forEach(ba(function(a){return this.addItem(a)},this));else{d=this.collection;for(b in d){if(!Y.call(d,b))continue;c=d[b],this.addItem(b)}}return this.processActionQueue()},a.prototype.handleItemsWereAdded=function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this.addItem(a,{fragment:!0}));return e},a.prototype.handleItemsWereRemoved=function(){var a,b,c,d,e;b=1>arguments.length?[]:X.call(arguments,0),e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this.removeItem(a));return e},a.prototype.handleArrayChanged=function(){var a,b,c,d,e,f;c=this.collection.toArray(),d=new A.SimpleHash;for(e=0,f=c.length;e<f;e++)b=c[e],a=this.nodeMap.get(b),d.set(b,!0),a?this.insertItem(b,a,{fragment:!1,actionNumber:this.queuedActionNumber++,sync:!0}):this.addItem(b,{fragment:!1});return this.nodeMap.forEach(ba(function(a,b){if(!d.hasKey(a))return this.removeItem(a)},this))},a.prototype.addItem=function(a,b){var c,d,e;return b==null&&(b={fragment:!0}),this.parentRenderer.prevent("rendered"),e=this,b.actionNumber=this.queuedActionNumber++,c=new A.Renderer(this._nodeForItem(a),function(){return e.insertItem(a,this.node,b)},this.renderContext.descend(a,this.iteratorName)),this.rendererMap.set(a,c),d=ba(function(){if(this.destroyed)return;return this.parentRenderer.allowAndFire("rendered")},this),c.on("rendered",d),c.on("stopped",ba(function(){if(this.destroyed)return;return this.actions[b.actionNumber]=function(){},d(),this.processActionQueue()},this)),a},a.prototype.removeItem=function(a){var b,c;if(this.destroyed)return;this._removeOldAction(a),c=this.nodeMap.unset(a);if(c)return(b=A.data(c,"hide"))?b.call(c):s(c)},a.prototype.insertItem=function(a,b,c){var d,e,f,g,h;c==null&&(c={});if(this.destroyed)return;return d=this.actionMap.get(a),d!=null&&d>c.actionNumber?this.actions[c.actionNumber]=function(){}:(this._removeOldAction(a),this.actionMap.set(a,c.actionNumber),this.nodeMap.get(a)!==b?(e=this.actions)[g=c.actionNumber]||(e[g]=function(){}):(this.rendererMap.unset(a),(f=this.actions)[h=c.actionNumber]||(f[h]=function(){var a;return a=A.data(b,"show"),typeof a=="function"?a.call(b,{before:this.siblingNode}):c.fragment?this.fragment.appendChild(b):k(this.parentNode,b,this.siblingNode)}))),this.actions[c.actionNumber].item=a,this.processActionQueue()},a.prototype.processActionQueue=function(){if(this.destroyed)return;if(!this.actionQueueTimeout)return this.actionQueueTimeout=t(ba(function(){var a,b;if(this.destroyed)return;delete this.actionQueueTimeout,b=new Date;while(!!(a=this.actions[this.currentActionNumber])){this.actions[this.currentActionNumber]=!0,a.call(this),this.currentActionNumber++;if(this.deferEvery&&new Date-b>this.deferEvery)return this.processActionQueue()}this.fragment&&this.rendererMap.length===0&&this.fragment.hasChildNodes()&&(k(this.parentNode,this.fragment,this.siblingNode),this.fragment=document.createDocumentFragment());if(this.currentActionNumber===this.queuedActionNumber)return this.parentRenderer.allowAndFire("rendered")},this))},a.prototype._nodeForItem=function(a){var b;return b=this.prototypeNode.cloneNode(!0),this.nodeMap.set(a,b),b},a.prototype._removeOldAction=function(a){var b;b=this.actionMap.get(a);if(b!=null&&b>this.currentActionNumber)return this.actionMap.unset(a),this.actions[b]=function(){}},a}(),D=function(a){return function(b){if(typeof b=="undefined")return;return a.apply(this,arguments)}},I=A.Filters={get:D(function(a,b){return a.get!=null?a.get(b):a[b]}),equals:D(function(a,b){return a===b}),not:function(a){return!a},truncate:D(function(a,b,c){return c==null&&(c="..."),a.length>b&&(a=a.substr(0,b-c.length)+c),a}),"default":function(a,b){return a||b},prepend:function(a,b){return b+a},append:function(a,b){return a+b},downcase:D(function(a){return a.toLowerCase()}),upcase:D(function(a){return a.toUpperCase()}),pluralize:D(function(a,b){return J.pluralize(b,a)}),join:D(function(a,b){return b==null&&(b=""),a.join(b)}),sort:D(function(a){return a.sort()}),map:D(function(a,b){return a.map(function(a){return a[b]})}),first:D(function(a){return a[0]}),meta:D(function(a,b){return a.meta.get(b)}),interpolate:function(a,b){var c,d,e;if(a==null)return;e={};for(c in b)d=b[c],e[c]=this.findKey(d)[0],e[c]==null&&(A.developer.warn("Warning! Undefined interpolation key "+c+" for interpolation",a),e[c]="");return A.helpers.interpolate(a,e)}},V=["capitalize","singularize","underscore","camelize"];for(R=0,T=V.length;R<T;R++)L=V[R],I[L]=D(J[L]);m(A,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){try{return H=document.createElement("div"),delete H.test}catch(a){return A.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?A.cache[a[A.expando]]:a[A.expando],!!a&&!K(a)},data:function(a,b,c,d){var e,f,g,h,i,j,k;if(!A.acceptData(a))return;h=A.expando,f=typeof b=="string",i=a.nodeType,e=i?A.cache:a,g=i?a[A.expando]:a[A.expando]&&A.expando;if((!g||d&&g&&e[g]&&!e[g][h])&&f&&c===void 0)return;g||(i&&a.nodeType!==3?a[A.expando]=g=++A.uuid:g=A.expando),e[g]||(e[g]={});if(typeof b=="object"||typeof b=="function")d?e[g][h]=m(e[g][h],b):e[g]=m(e[g],b);return k=e[g],d&&(k[h]||(k[h]={}),k=k[h]),c!==void 0&&(k[J.camelize(b,!0)]=c),f?(j=k[b],j==null&&(j=k[J.camelize(b,!0)])):j=k,j},removeData:function(a,b,c){var d,e,f,g,h,i;if(!A.acceptData(a))return;g=A.expando,h=a.nodeType,d=h?A.cache:a,e=h?a[A.expando]:A.expando;if(!d[e])return;if(b){i=c?d[e][g]:d[e];if(i){i[b]||(b=J.camelize(b,!0)),delete i[b];if(!K(i))return}}if(c){delete d[e][g];if(!K(d[e]))return}f=d[e][g],A.canDeleteExpando||!d.setInterval?delete d[e]:d[e]=null;if(f)return d[e]={},d[e][g]=f;if(h)return A.canDeleteExpando?delete a[A.expando]:a.removeAttribute?a.removeAttribute(A.expando):a[A.expando]=null},_data:function(a,b,c){return A.data(a,b,c,!0)},acceptData:function(a){var b;if(a.nodeName){b=A.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),K=function(a){var b;for(b in a)return!1;return!0},M=A.mixins=new A.Object,A.Encoders={},A.Paginator=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Object),a.Cache=function(){function a(a,b,c){this.offset=a,this.limit=b,this.items=c,this.length=c.length,this.reach=a+b}return a.prototype.containsItemsForOffsetAndLimit=function(a,b){return a>=this.offset&&a+b<=this.reach},a.prototype.itemsForOffsetAndLimit=function(a,b){var c,d;if(!this.containsItemsForOffsetAndLimit(a,b))return;return c=a-this.offset,d=c+b,this.items.slice(c,d)},a}(),a.prototype.offset=0,a.prototype.limit=10,a.prototype.totalCount=0,a.prototype.offsetFromPageAndLimit=function(a,b){return Math.round((+a-1)*b)},a.prototype.pageFromOffsetAndLimit=function(a,b){return a/b+1},a.prototype.toArray=function(){var a,b,c,d;return a=this.get("cache"),d=this.get("offset"),c=this.get("limit"),b=a!=null?a.itemsForOffsetAndLimit(d,c):void 0,b||this.loadItemsForOffsetAndLimit(d,c),b||[]},a.prototype.page=function(){return this.pageFromOffsetAndLimit(this.get("offset"),this.get("limit"))},a.prototype.pageCount=function(){return Math.ceil(this.get("totalCount")/this.get("limit"))},a.prototype.previousPage=function(){return this.set("page",this.get("page")-1)},a.prototype.nextPage=function(){return this.set("page",this.get("page")+1)},a.prototype.loadItemsForOffsetAndLimit=function(a,b){},a.prototype.updateCache=function(a,b,c){return this.set("cache",new A.Paginator.Cache(a,b,c))},a.accessor("toArray",a.prototype.toArray),a.accessor("offset","limit","totalCount",{get:A.Property.defaultAccessor.get,set:function(a,b){return A.Property.defaultAccessor.set.call(this,a,+b)}}),a.accessor("page",{get:a.prototype.page,set:function(a,b){return b=+b,this.set("offset",this.offsetFromPageAndLimit(b,this.get("limit"))),b}}),a.accessor("pageCount",a.prototype.pageCount),a}(),A.ModelPaginator=function(){function a(){a.__super__.constructor.apply(this,arguments)}return _(a,A.Paginator),a.prototype.cachePadding=0,a.prototype.paddedOffset=function(a){return a-=this.cachePadding,a<0?0:a},a.prototype.paddedLimit=function(a){return a+this.cachePadding*2},a.prototype.loadItemsForOffsetAndLimit=function(a,b){var c,d,e,f;d=this.paramsForOffsetAndLimit(a,b),f=this.params;for(c in f)e=f[c],d[c]=e;return this.model.load(d,ba(function(a,b){if(a==null)return this.updateCache(this.offsetFromParams(d),this.limitFromParams(d),b)},this))},a.prototype.paramsForOffsetAndLimit=function(a,b){return{offset:this.paddedOffset(a),limit:this.paddedLimit(b)}},a.prototype.offsetFromParams=function(a){return a.offset},a.prototype.limitFromParams=function(a){return a.limit},a}(),G=typeof exports!="undefined"&&exports!==null?(module.exports=A,global):(window.Batman=A,window),m(G,A.Observable),A.exportHelpers=function(a){var b,c,d,e;e=["mixin","unmixin","route","redirect","typeOf","redirect","setImmediate"];for(c=0,d=e.length;c<d;c++)b=e[c],a["$"+b]=A[b];return a},A.exportGlobals=function(){return A.exportHelpers(G)},A.Request.prototype.send=function(a){var b,c;b={url:this.get("url"),type:this.get("method"),dataType:this.get("type"),data:a||this.get("data"),username:this.get("username"),password:this.get("password"),beforeSend:ba(function(){return this.fire("loading")},this),success:ba(function(a,b,c){return this.set("status",c.status),this.set("response",a),this.fire("success",a)},this),error:ba(function(a,b,c){return this.set("status",a.status),this.set("response",a.responseText),a.request=this,this.fire("error",a)},this),complete:ba(function(){return this.fire("loaded")},this)};if((c=this.get("method"))==="PUT"||c==="POST")this.get("formData")?(b.contentType=!1,b.processData=!1,b.data=this.constructor.objectToFormData(b.data)):b.contentType=this.get("contentType");return jQuery.ajax(b)},A.mixins.animation={show:function(a){var b,c,d,e;return b=$(this),c=function(){return b.show(600)},a?((d=a.append)!=null&&d.appendChild(this),(e=a.before)!=null&&e.parentNode.insertBefore(this,a.before),b.hide(),setTimeout(c,0)):c(),this},hide:function(a){return $(this).hide(600,ba(function(){var b;return a&&(b=this.parentNode)!=null&&b.removeChild(this),A.DOM.didRemoveNode(this)},this)),this}}}).call(this)